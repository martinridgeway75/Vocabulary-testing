window.addEventListener("load",(function(){!function(){"use strict";var hgmObj={time:0,tchr:"",clss:"",frag:"",voca:[],gameArr:[],currentWrd:[],count:0};function signOutOfApp(){firebase.auth().signOut()}function handlersOn(){navListenersOn(),docEl("restart").addEventListener("click",initGame,{capture:"false",passive:"true"}),docEl("nxtBtn").addEventListener("click",getNextWord,{capture:"false",passive:"true"}),docEl("chgSelected").addEventListener("click",updateClss,{capture:!1,passive:!0})}function matchGuess(letter){var lwrCs=letter.toLowerCase(),idxArr=[],i;for(i=0;i<hgmObj.currentWrd.length;i++)lwrCs===hgmObj.currentWrd[i]&&idxArr.push(i);return idxArr}function isComplete(num){hgmObj.count+=num,hgmObj.count>=hgmObj.currentWrd.length&&(docEl("hangmanBox").className+=" win")}function chkGuess(letter){var indexes=matchGuess(letter);indexes.length&&(indexes.forEach((function(idx){docEl("w_"+idx).className="",docEl("w_"+idx).textContent=hgmObj.currentWrd[idx]})),isComplete(indexes.length))}function identifyKybd(e){e.target!==e.currentTarget&&e.target.classList.contains("btn")&&(chkGuess(e.target.textContent),e.target.className+=" strikeOut"),e.stopPropagation()}function populateHangmanBox(){var container=docEl("hangmanBox"),frag=document.createDocumentFragment();container.className=container.className.replace(/(?:^|\s)win(?!\S)/g,""),emptyContent(container),hgmObj.currentWrd.forEach((function(el,idx){var newDiv1=document.createElement("div"),newSpan1=document.createElement("span");newSpan1.id="w_"+idx," "===el?(newSpan1.className="isWhitespace",hgmObj.count+=1):(newSpan1.className="nonVisible",newSpan1.textContent="?"),newDiv1.appendChild(newSpan1),frag.appendChild(newDiv1)})),container.appendChild(frag)}function getNextWord(){var nextObj,nextWrd,cols;kybdOff(),hgmObj.count=0,hgmObj.gameArr.length?(nextWrd=(nextObj=hgmObj.gameArr.splice(0,1)[0]).en.toLowerCase(),hgmObj.currentWrd=nextWrd.split(""),cols=nextObj.colOptAns,docEl("synHint").textContent=nextObj.synOptAns,docEl("ctxHint").textContent=nextObj.ctxB4+" _____ "+nextObj.ctxAf,"af"===nextObj.colPos?(docEl("colHint").textContent="~ "+cols[0]+" / ",docEl("colHint").textContent+=" ~ "+cols[1]+" / ",docEl("colHint").textContent+=" ~ "+cols[2]):(docEl("colHint").textContent=cols[0]+" ~ / ",docEl("colHint").textContent+=cols[1]+" ~ / ",docEl("colHint").textContent+=cols[2]+" ~"),populateHangmanBox(),kybdOn()):allComplete()}function kybdOn(){docEl("kybd").addEventListener("click",identifyKybd,{capture:"false",passive:"true"})}function kybdOff(){var kybdEls=docEl("kybd").querySelectorAll(".btn"),i;for(docEl("kybd").removeEventListener("click",identifyKybd,{capture:"false",passive:"true"}),i=0;i<kybdEls.length;i++)kybdEls[i].className=kybdEls[i].className.replace(/(?:^|\s)strikeOut(?!\S)/g,"")}function allComplete(){var len=hgmObj.voca.length;emptyContent(docEl("hangmanBox")),docEl("nxtBtn").style.display="none",docEl("hints").style.display="none",docEl("mem-feedback").style.display="block",userScored(len,len)}function initGame(){kybdOn(),hgmObj.gameArr=hgmObj.voca.slice(0),shuffleAnArray(hgmObj.gameArr),docEl("mem-feedback").style.display="none",getNextWord(),docEl("nxtBtn").style.display="inline-block",docEl("hints").style.display="block",hgmObj.time=Date.now()}function convertData(data){var colEl;data.forEach((function(el){el.hasOwnProperty("syn")&&el.hasOwnProperty("col")&&((colEl={}).en=el.en,colEl.ctxB4=el.syn.b4,colEl.ctxAf=el.syn.af,colEl.synOptAns=el.syn.ans,colEl.colPos=el.col.pos,colEl.colOptAns=[el.col.ans1,el.col.ans2,el.col.ans3],hgmObj.voca.push(colEl))})),initGame()}function init(){var objExists=window.localStorage.getItem("myClss"),data=JSON.parse(objExists);if(null!==data){try{hgmObj.tchr=data.tchr,hgmObj.clss=data.clss,data.hasOwnProperty("frag")&&!0===chkTrk(data.frag)&&(hgmObj.frag=data.frag),convertData(data.voca)}catch(e){hgmObj.tchr="",hgmObj.clss="",hgmObj.voca=[],dataError()}docEl("slctdTchrTxt").textContent=hgmObj.clss+" "+hgmObj.tchr+" "+hgmObj.frag}else dataError();renderNav(),handlersOn()}function userScored(scr,max){var score="completed: "+scr+"/"+max,timeStamp=Date.now(),duration=timeStamp-hgmObj.time;postIt({a:timeStamp,b:hgmObj.tchr,c:hgmObj.clss,d:hgmObj.frag,e:duration,f:document.title,g:score})}function postIt(dataObj){var user=firebase.auth().currentUser,uid=user.uid,postData={email:user.email,timestamp:dataObj.a,tchr:dataObj.b,clss:dataObj.c,frag:dataObj.d,duration:dataObj.e,activity:dataObj.f,score:dataObj.g},newPostKey,updates={};updates["activities/"+uid+"/"+firebase.database().ref().child("activities/"+uid+"/").push().key]=postData,firebase.database().ref().update(updates,(function(e){e?"PERMISSION_DENIED"===e.code?signOutOfApp():window.alert("Data could not be saved.\n"+e):window.alert("Activity completed!")}))}firebase.auth().onAuthStateChanged((function(user){user?(docEl("usrPhoto").src=user.photoURL,init()):window.location="../index.html"}))}()}));