window.addEventListener("load",(function(){!function(){"use strict";var synObj={time:0,myClss:{tchr:"",clss:"",frag:"",voca:[]},gameArr:[],leftArr:[],rightArr:[],matched:0,numOfCards:0};function signOutOfApp(){firebase.auth().signOut()}function handlersOn(){navListenersOn(),docEl("synCtx").addEventListener("click",showSyn,{capture:!1,passive:!0}),docEl("transCtx").addEventListener("click",showTrans,{capture:!1,passive:!0}),docEl("restart").addEventListener("click",initGame,{capture:!1,passive:!0}),docEl("continueGame").addEventListener("click",continueOn,{capture:!1,passive:!0}),docEl("chgSelected").addEventListener("click",updateClss,{capture:!1,passive:!0})}function makeDeck(){var len=synObj.gameArr.length,dealtHand=[],idx;synObj.numOfCards=len<10?len:10,shuffleAnArray(synObj.gameArr),(dealtHand=synObj.gameArr.splice(0,synObj.numOfCards)).forEach((function(el,i){idx=i+1,synObj.leftArr.push([idx,el[0]]),synObj.rightArr.push([idx,el[1],el[2]])})),synObj.leftArr=shuffleAnArray(synObj.leftArr)}function putCardsOnTheTable(){createUILeft(),createUIRight()}function createUILeft(){var container=docEl("cardPile");synObj.leftArr.forEach((function(el,i){var frag=document.createDocumentFragment(),newDiv1=document.createElement("div"),jqId="#c_"+synObj.leftArr[i][0];newDiv1.id="c_"+synObj.leftArr[i][0],newDiv1.className="ui-draggable",newDiv1.dataset.num=synObj.leftArr[i][0],newDiv1.textContent=synObj.leftArr[i][1],frag.appendChild(newDiv1),container.appendChild(frag),$(jqId).draggable({containment:"#content",stack:"#cardPile div",cursor:"move",revert:!1})}))}function createUIRight(){var container=docEl("cardSlots"),dropEls,i;for(synObj.rightArr.forEach((function(el,idx){var frag=document.createDocumentFragment(),newDiv1=document.createElement("div"),newSpan1=document.createElement("span"),newSpan2=document.createElement("span");newDiv1.dataset.num=synObj.rightArr[idx][0],newDiv1.className="ui-droppable",newSpan1.className="syn",newSpan1.textContent=synObj.rightArr[idx][1],newSpan2.className="trans nodisplay",newSpan2.textContent=synObj.rightArr[idx][2],newDiv1.appendChild(newSpan1),newDiv1.appendChild(newSpan2),frag.appendChild(newDiv1),container.appendChild(frag)})),dropEls=docEl("cardSlots").querySelectorAll("div.ui-droppable"),i=0;i<dropEls.length;i++)$(dropEls[i]).droppable({accept:"#cardPile div",hoverClass:"hovered",drop:cardDrop})}function cardDrop(evt,ui){var element=this,maxNum=synObj.numOfCards,slotNum,cardNum,i;if($(this).data("num")===ui.draggable.data("num")?(ui.draggable.addClass("correct"),ui.draggable.draggable("disable"),$(this).droppable("disable"),ui.draggable.position({of:$(this),my:"left top",at:"left top"}),ui.draggable.draggable("option","revert",!1),synObj.matched=synObj.matched+1):ui.draggable.position({of:$(this),my:"left top",at:"left top"}),synObj.matched===maxNum){for(i=1;i<=maxNum;i++){var elId="#c_"+i;$(elId).position({of:$(elId),my:"right top",at:"left top"})}var dropEls=docEl("cardSlots").querySelectorAll("div.ui-droppable"),ii;for(ii=0;ii<dropEls.length;ii++)dropEls[ii].style.borderStyle="solid";showEl("successMsg"),showEl("continueGame")}}function toggleLanguage(bool){var syn=document.querySelectorAll(".syn"),trans=document.querySelectorAll(".trans"),i;if(!0===bool){for(i=0;i<syn.length;i++)syn[i].className=syn[i].className.replace(/(?:^|\s)nodisplay(?!\S)/g,"");for(i=0;i<trans.length;i++)trans[i].className+=" nodisplay"}else{for(i=0;i<syn.length;i++)syn[i].className+=" nodisplay";for(i=0;i<trans.length;i++)trans[i].className=trans[i].className.replace(/(?:^|\s)nodisplay(?!\S)/g,"")}}function showSyn(){toggleLanguage(!0)}function showTrans(){toggleLanguage(!1)}function playGame(){emptyContent(docEl("cardPile")),emptyContent(docEl("cardSlots")),synObj.matched=0,synObj.leftArr=[],synObj.rightArr=[],makeDeck(),putCardsOnTheTable()}function endGame(){hideEl("continueGame"),docEl("successMsg").querySelectorAll("h5.winner")[0].textContent="Great job!",showEl("successMsg"),showEl("restart"),userScored(synObj.myClss.voca.length)}function continueOn(){hideEl("successMsg"),hideEl("restart"),hideEl("continueGame"),startGame()}function startGame(){!synObj.gameArr.length||synObj.gameArr.length<2?endGame():playGame()}function initGame(){var tempArr;if(hideEl("successMsg"),hideEl("restart"),hideEl("continueGame"),docEl("successMsg").querySelectorAll("h5.winner")[0].textContent="",!synObj.myClss.voca.length||synObj.myClss.voca.length<2)return hideEl("content"),document.querySelectorAll("fieldset.md-radio")[0].style.display="none",void showEl("noVoca");synObj.gameArr=[],synObj.myClss.voca.forEach((function(el){el.hasOwnProperty("syn")&&(tempArr=[el.en,el.syn.ans,el.kr].slice(0),synObj.gameArr.push(tempArr))})),synObj.time=Date.now(),startGame()}function init(){var objExists=window.localStorage.getItem("myClss"),data=JSON.parse(objExists);if(null!==data){try{synObj.myClss.tchr=data.tchr,synObj.myClss.clss=data.clss,data.hasOwnProperty("frag")&&!0===chkTrk(data.frag)&&(synObj.myClss.frag=data.frag),synObj.myClss.voca=data.voca}catch(e){synObj.myClss.tchr="",synObj.myClss.clss="",synObj.myClss.voca=[],dataError()}synObj.myClss.voca.length?(renderNav(),docEl("slctdTchrTxt").textContent=synObj.myClss.clss+" "+synObj.myClss.tchr+" "+synObj.myClss.frag,initGame(),handlersOn()):showEl("noVoca")}else dataError()}function userScored(scr){var score="completed: "+scr+"/"+scr,timeStamp=Date.now(),duration=timeStamp-synObj.time;postIt({a:timeStamp,b:synObj.myClss.tchr,c:synObj.myClss.clss,d:synObj.myClss.frag,e:duration,f:document.title,g:score})}function postIt(dataObj){var user=firebase.auth().currentUser,uid=user.uid,postData={email:user.email,timestamp:dataObj.a,tchr:dataObj.b,clss:dataObj.c,frag:dataObj.d,duration:dataObj.e,activity:dataObj.f,score:dataObj.g},newPostKey,updates={};updates["activities/"+uid+"/"+firebase.database().ref().child("activities/"+uid+"/").push().key]=postData,firebase.database().ref().update(updates,(function(e){e?"PERMISSION_DENIED"===e.code?signOutOfApp():window.alert("Data could not be saved.\n"+e):window.alert("Activity completed!")}))}firebase.auth().onAuthStateChanged((function(user){user?(docEl("usrPhoto").src=user.photoURL,jQuery(document).ready((function(){init()}))):window.location="../index.html"}))}()}));