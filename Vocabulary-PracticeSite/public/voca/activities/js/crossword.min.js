window.addEventListener("load",(function(){!function(){"use strict";var cwObj={time:0,tchr:"",clss:"",frag:"",words:[],clues:[],countedLetters:0,cellulose:0};function signOutOfApp(){firebase.auth().signOut()}function CrosswordCell(letter){this.char=letter,this.across=null,this.down=null}function CrosswordCellNode(is_start_of_word,index){this.is_start_of_word=is_start_of_word,this.index=index}function WordElement(word,index){this.word=word,this.index=index}function Crossword(words_in,clues_in,num_rows,num_cols){var GRID_ROWS=num_rows,GRID_COLS=num_cols,char_index={},bad_words;this.getSquareGrid=function(max_tries){var best_grid=null,best_ratio=0,ratio,a_grid,i;for(i=0;i<max_tries&&(null==(a_grid=this.getGrid(1))||((ratio=1*Math.min(a_grid.length,a_grid[0].length)/Math.max(a_grid.length,a_grid[0].length))>best_ratio&&(best_grid=a_grid,best_ratio=ratio),1!=best_ratio));i++);return best_grid},this.getGrid=function(max_tries){var start_dir,r,rr,c,cc,g,i,dir,word_element,groups,word_has_been_added_to_grid,word_el,best_position,tries;for(tries=0;tries<max_tries;tries++){if(clear(),start_dir=randomDirection(),r=Math.floor(grid.length/2),c=Math.floor(grid[0].length/2),word_element=word_elements[0],"across"==start_dir?c-=Math.floor(word_element.word.length/2):r-=Math.floor(word_element.word.length/2),!1===canPlaceWordAt(word_element.word,r,c,start_dir))return bad_words=[word_element],null;for(placeWordAt(word_element.word,word_element.index,r,c,start_dir),(groups=[]).push(word_elements.slice(1)),g=0;g<groups.length;g++){for(word_has_been_added_to_grid=!1,i=0;i<groups[g].length;i++)word_el=groups[g][i],(best_position=findPositionForWord(word_el.word))?(rr=best_position.row,cc=best_position.col,dir=best_position.direction,placeWordAt(word_el.word,word_el.index,rr,cc,dir),word_has_been_added_to_grid=!0):(groups.length-1==g&&groups.push([]),groups[g+1].push(word_el));if(!word_has_been_added_to_grid)break}if(word_has_been_added_to_grid)return minimizeGrid()}return bad_words=groups[groups.length-1],null},this.getBadWords=function(){return bad_words},this.getLegend=function(grid){var groups={across:[],down:[]},position=1,r,c,cell,increment_position,index;for(r=0;r<grid.length;r++)for(c=0;c<grid[r].length;c++){for(var k in cell=grid[r][c],increment_position=!1,groups)cell&&cell[k]&&cell[k].is_start_of_word&&(index=cell[k].index,groups[k].push({position:position,index:index,clue:clues_in[index],word:words_in[index]}),increment_position=!0);increment_position&&position++}return groups};var minimizeGrid=function(){var r_min=GRID_ROWS-1,r_max=0,c_min=GRID_COLS-1,c_max=0,r,r2,c,c2,cell,rows,cols,new_grid;for(r=0;r<GRID_ROWS;r++)for(c=0;c<GRID_COLS;c++)null!=(cell=grid[r][c])&&(r<r_min&&(r_min=r),r>r_max&&(r_max=r),c<c_min&&(c_min=c),c>c_max&&(c_max=c));for(rows=r_max-r_min+1,cols=c_max-c_min+1,new_grid=new Array(rows),r=0;r<rows;r++)for(c=0;c<cols;c++)new_grid[r]=new Array(cols);for(r=r_min,r2=0;r2<rows;r++,r2++)for(c=c_min,c2=0;c2<cols;c++,c2++)new_grid[r2][c2]=grid[r][c];return new_grid},addCellToGrid=function(word,index_of_word_in_input_list,index_of_char,r,c,direction){var char=word.charAt(index_of_char),is_start_of_word;null==grid[r][c]&&(grid[r][c]=new CrosswordCell(char),char_index[char]||(char_index[char]=[]),char_index[char].push({row:r,col:c})),is_start_of_word=0==index_of_char,grid[r][c][direction]=new CrosswordCellNode(is_start_of_word,index_of_word_in_input_list)},placeWordAt=function(word,index_of_word_in_input_list,row,col,direction){var r,c,i;if("across"==direction)for(c=col,i=0;c<col+word.length;c++,i++)addCellToGrid(word,index_of_word_in_input_list,i,row,c,direction);else{if("down"!=direction)throw"Invalid Direction";for(r=row,i=0;r<row+word.length;r++,i++)addCellToGrid(word,index_of_word_in_input_list,i,r,col,direction)}},canPlaceCharAt=function(char,row,col){return null==grid[row][col]?0:grid[row][col].char==char&&1},canPlaceWordAt=function(word,row,col,direction){var intersections,is_empty,is_intersection,can_place_here,r,c,i,result;if(row<0||row>=grid.length||col<0||col>=grid[row].length)return!1;if("across"==direction){if(col+word.length>grid[row].length)return!1;if(col-1>=0&&null!=grid[row][col-1])return!1;if(col+word.length<grid[row].length&&null!=grid[row][col+word.length])return!1;for(r=row-1,c=col,i=0;r>=0&&c<col+word.length;c++,i++)if(is_empty=null==grid[r][c],is_intersection=null!=grid[row][c]&&grid[row][c].char==word.charAt(i),!(can_place_here=is_empty||is_intersection))return!1;for(r=row+1,c=col,i=0;r<grid.length&&c<col+word.length;c++,i++)if(is_empty=null==grid[r][c],is_intersection=null!=grid[row][c]&&grid[row][c].char==word.charAt(i),!(can_place_here=is_empty||is_intersection))return!1;for(intersections=0,c=col,i=0;c<col+word.length;c++,i++){if(!1===(result=canPlaceCharAt(word.charAt(i),row,c)))return!1;intersections+=result}}else{if("down"!=direction)throw"Invalid Direction";if(row+word.length>grid.length)return!1;if(row-1>=0&&null!=grid[row-1][col])return!1;if(row+word.length<grid.length&&null!=grid[row+word.length][col])return!1;for(c=col-1,r=row,i=0;c>=0&&r<row+word.length;r++,i++)if(is_empty=null==grid[r][c],is_intersection=null!=grid[r][col]&&grid[r][col].char==word.charAt(i),!(can_place_here=is_empty||is_intersection))return!1;for(c=col+1,r=row,i=0;r<row+word.length&&c<grid[r].length;r++,i++)if(is_empty=null==grid[r][c],is_intersection=null!=grid[r][col]&&grid[r][col].char==word.charAt(i),!(can_place_here=is_empty||is_intersection))return!1;for(intersections=0,r=row,i=0;r<row+word.length;r++,i++){if(!1===(result=canPlaceCharAt(word.charAt(i,1),r,col)))return!1;intersections+=result}}return intersections},randomDirection=function(){return Math.floor(2*Math.random())?"across":"down"},findPositionForWord=function(word){var bests=[],i,j,point,r,c,possible_locations_on_grid,intersections_across,intersections_down,best;for(i=0;i<word.length;i++)if(possible_locations_on_grid=char_index[word.charAt(i)])for(j=0;j<possible_locations_on_grid.length;j++)r=(point=possible_locations_on_grid[j]).row,c=point.col,intersections_across=canPlaceWordAt(word,r,c-i,"across"),intersections_down=canPlaceWordAt(word,r-i,c,"down"),!1!==intersections_across&&bests.push({intersections:intersections_across,row:r,col:c-i,direction:"across"}),!1!==intersections_down&&bests.push({intersections:intersections_down,row:r-i,col:c,direction:"down"});return 0!=bests.length&&bests[Math.floor(Math.random()*bests.length)]},clear=function(){var r,c;for(r=0;r<grid.length;r++)for(c=0;c<grid[r].length;c++)grid[r][c]=null;char_index={}};if(words_in.length<2)throw new Error("A crossword must have at least 2 words");if(words_in.length!=clues_in.length)throw new Error("The number of words must equal the number of clues");var grid=new Array(GRID_ROWS),i;for(i=0;i<GRID_ROWS;i++)grid[i]=new Array(GRID_COLS);var word_elements=[];for(i=0;i<words_in.length;i++)word_elements.push(new WordElement(words_in[i],i));word_elements.sort((function(a,b){return b.word.length-a.word.length}))}firebase.auth().onAuthStateChanged((function(user){user?(docEl("usrPhoto").src=user.photoURL,init()):window.location="../index.html"}));var CrosswordUtils_toHtml=function(grid){if(null!=grid){var label=1,frag=document.createDocumentFragment(),newTbl=document.createElement("table"),r,c,cell,is_start_of_word,char,css_class;for(newTbl.id="xword",newTbl.className="crossword",r=0;r<grid.length;r++){var newTr=document.createElement("tr");for(c=0;c<grid[r].length;c++){is_start_of_word=!1,null===(cell=grid[r][c])?(char=" ",css_class="no-border"):(char=cell.char,css_class="xword-cell",is_start_of_word=cell.across&&cell.across.is_start_of_word||cell.down&&cell.down.is_start_of_word,cwObj.cellulose+=1);var newTd=document.createElement("td");if(newTd.className=css_class,is_start_of_word){var newSpan=document.createElement("span");newSpan.textContent=label,newTd.appendChild(newSpan),label++}if(null!==cell){var newInput=document.createElement("input");newInput.dataset.alpha=char,newInput.maxLength="1",newTd.appendChild(newInput)}newTr.appendChild(newTd)}newTbl.appendChild(newTr)}return frag.appendChild(newTbl),frag}};function addLegendToPage(groups){var i;for(var k in groups){var frag=document.createDocumentFragment(),len=groups[k].length;for(i=0;i<len;i++){var newLi=document.createElement("li"),newSpan=document.createElement("span"),newTxtPos=document.createTextNode(groups[k][i].position+". "),newTxtClue=document.createTextNode(""+groups[k][i].clue);newSpan.style.fontWeight=700,newSpan.appendChild(newTxtPos),newLi.appendChild(newSpan),newLi.appendChild(newTxtClue),frag.appendChild(newLi)}docEl(k).appendChild(frag)}}function increaseCount(){cwObj.countedLetters+=1,cwObj.countedLetters===cwObj.cellulose&&(cwObj.countedLetters=0,userScored(cwObj.words.length))}function chkInputChange(el){el.target===el.currentTarget&&"INPUT"===el.target.nodeName&&el.target.attributes[0].value===el.target.value.toLowerCase()&&(el.target.removeEventListener("change",chkInputChange,{capture:!1,passive:!0}),el.target.className+=" done",el.target.disabled="true",increaseCount()),el.stopPropagation()}function handlersOn(){navListenersOn(),docEl("chgSelected").addEventListener("click",updateClss,{capture:!1,passive:!0});var nodes=docEl("xword").querySelectorAll("input"),i;for(i=0;i<nodes.length;i++)nodes[i].addEventListener("change",chkInputChange,{capture:!1,passive:!0})}function tryAgain(){var idxOfLongestWord=0;cwObj.words.forEach((function(el,i){cwObj.words[idxOfLongestWord].length<cwObj.words[i].length&&(idxOfLongestWord=i)})),cwObj.words.splice(idxOfLongestWord,1),cwObj.clues.splice(idxOfLongestWord,1),buildXword()}function showH3s(){var nodes=docEl("puzzle-hints").querySelectorAll("h3.nodisplay"),i;for(i=0;i<nodes.length;i++)nodes[i].className=""}function buildXword(){var cw=new Crossword(cwObj.words,cwObj.clues,13,13),tries=100,grid=cw.getSquareGrid(100);if(null!==grid){var frag=CrosswordUtils_toHtml(grid,!0);docEl("puzzle-holder").appendChild(frag),addLegendToPage(cw.getLegend(grid)),showH3s(),cwObj.time=Date.now()}else cwObj.words.length>5?tryAgain():showEmpty()}function prepData(voca){voca.forEach((function(el){el.hasOwnProperty("syn")&&(cwObj.words.push(el.en),cwObj.clues.push(el.syn.b4+" ____ "+el.syn.af))}))}function showEmpty(){docEl("puzzle-wrapper").style.display="none",docEl("novoca").style.display="block",cwObj.countedLetters=-1}function init(){var objExists=window.localStorage.getItem("myClss"),data=JSON.parse(objExists);if(null!==data){try{prepData(data.voca),cwObj.tchr=data.tchr,cwObj.clss=data.clss,data.hasOwnProperty("frag")&&!0===chkTrk(data.frag)&&(cwObj.frag=data.frag)}catch(e){cwObj.tchr="",cwObj.clss="",cwObj.words=[],cwObj.clues=[],dataError()}docEl("slctdTchrTxt").textContent=cwObj.clss+" "+cwObj.tchr+" "+cwObj.frag}else dataError();cwObj.words.length&&cwObj.clues.length?buildXword():showEmpty(),renderNav(),handlersOn()}function userScored(scr){var score="completed: "+scr+"/"+scr,timeStamp=Date.now(),duration=timeStamp-cwObj.time;postIt({a:timeStamp,b:cwObj.tchr,c:cwObj.clss,d:cwObj.frag,e:duration,f:document.title,g:score})}function postIt(dataObj){var user=firebase.auth().currentUser,uid=user.uid,postData={email:user.email,timestamp:dataObj.a,tchr:dataObj.b,clss:dataObj.c,frag:dataObj.d,duration:dataObj.e,activity:dataObj.f,score:dataObj.g},newPostKey,updates={};updates["activities/"+uid+"/"+firebase.database().ref().child("activities/"+uid+"/").push().key]=postData,firebase.database().ref().update(updates,(function(e){e?"PERMISSION_DENIED"===e.code?signOutOfApp():window.alert("Data could not be saved.\n"+e):window.alert("Activity completed!")}))}}()}));