window.addEventListener("load",(function(){!function(){"use strict";var appVoca={practiceArr:[],errorObjs:{},examObjs:{current:{},currentUids:{},previous:{}},pending:{userCreated:{},isSelected:{pending:!1,exam:!1},enCache:[]},settings:{type:"",version:"",user:"",date:"",bookUnits:[],editMode:!0,isMod:!1,refresh:{uid:"",cat:""}},data:{},texts:{}};function signOutOfApp(){firebase.auth().signOut()}function docEl(elId){return document.getElementById(elId)}function handlersOn(){docEl("foo-filters").addEventListener("click",filterVoca,{capture:!1,passive:!0}),docEl("canPreviewDiv").addEventListener("click",previewTsksFromLi,{capture:!1,passive:!0}),docEl("bop").addEventListener("click",previewTsksFromLi,{capture:!1,passive:!0}),docEl("foo2").addEventListener("click",identifyTsk5Li,{capture:!1,passive:!0}),docEl("rTbar").addEventListener("click",identifyElForTskBoxSwitch,{capture:!1,passive:!0}),docEl("rTbaz").addEventListener("click",identifyElForTskBoxSwitch,{capture:!1,passive:!0}),docEl("rTurbaz").addEventListener("click",identifyElForTskBoxSwitch,{capture:!1,passive:!0}),docEl("rTcolin").addEventListener("click",identifyElForTskBoxSwitch,{capture:!1,passive:!0}),docEl("screenButtons").addEventListener("click",identifyScreenBtn,{capture:!1,passive:!0}),docEl("reportError").addEventListener("click",reportErrorInData,{capture:!1,passive:!0}),docEl("newVocaBtn").addEventListener("click",newWordRequest,{capture:!1,passive:!0}),docEl("previousExamsContainer").addEventListener("click",identifyDeletePreviousTestEl,{capture:!1,passive:!0}),docEl("logout").addEventListener("click",signOutOfApp,{capture:!1,passive:!0}),docEl("cls-filters").addEventListener("click",filterByClss,{capture:!1,passive:!0})}function newReqHandlersOn(){docEl("newTargetWord").addEventListener("keyup",keyUpOnNewTargetWord,{capture:!1,passive:!0}),docEl("nGmrTgt0").addEventListener("keyup",updatenGmrTgt0Drone,{capture:!1,passive:!0}),docEl("nGmrTgt1").addEventListener("keyup",updatenGmrTgt1Drone,{capture:!1,passive:!0}),docEl("nGmrTgt2").addEventListener("keyup",updatenGmrTgt2Drone,{capture:!1,passive:!0}),docEl("colPos0").addEventListener("click",leaveColRight,{capture:!1,passive:!0}),docEl("colPos1").addEventListener("click",pullColLeft,{capture:!1,passive:!0}),docEl("awaitingBucket").addEventListener("click",identifyPendingListEl,{capture:!1,passive:!0}),docEl("clearLoadedPendingWord").addEventListener("click",clearForNewPendingWord,{capture:!1,passive:!0}),docEl("allColDistractors").addEventListener("click",viewColDistractors,{capture:!1,passive:!0}),docEl("reqSectionAllCols").addEventListener("click",identifyColDisSelected,{capture:!1,passive:!0}),docEl("loadSelectedColDis").addEventListener("click",loadSelectedColDistractors,{capture:!1,passive:!0}),docEl("exitColDisDiv").addEventListener("click",exitColDistractors,{capture:!1,passive:!0})}function newReqHandlersOff(){docEl("newTargetWord").removeEventListener("keyup",keyUpOnNewTargetWord,{capture:!1,passive:!0}),docEl("nGmrTgt0").removeEventListener("keyup",updatenGmrTgt0Drone,{capture:!1,passive:!0}),docEl("nGmrTgt1").removeEventListener("keyup",updatenGmrTgt1Drone,{capture:!1,passive:!0}),docEl("nGmrTgt2").removeEventListener("keyup",updatenGmrTgt2Drone,{capture:!1,passive:!0}),docEl("colPos0").removeEventListener("click",leaveColRight,{capture:!1,passive:!0}),docEl("colPos1").removeEventListener("click",pullColLeft,{capture:!1,passive:!0}),docEl("awaitingBucket").removeEventListener("click",identifyPendingListEl,{capture:!1,passive:!0}),docEl("clearLoadedPendingWord").removeEventListener("click",clearForNewPendingWord,{capture:!1,passive:!0}),docEl("allColDistractors").removeEventListener("click",viewColDistractors,{capture:!1,passive:!0}),docEl("reqSectionAllCols").removeEventListener("click",identifyColDisSelected,{capture:!1,passive:!0}),docEl("loadSelectedColDis").removeEventListener("click",loadSelectedColDistractors,{capture:!1,passive:!0}),docEl("exitColDisDiv").removeEventListener("click",exitColDistractors,{capture:!1,passive:!0})}function emptyContent(parentEl){for(;parentEl.hasChildNodes();){for(;parentEl.lastChild.hasChildNodes();)parentEl.lastChild.removeChild(parentEl.lastChild.lastChild);parentEl.removeChild(parentEl.lastChild)}}function shuffleArray(arr){for(var crtIdx=arr.length,tmpVal,rndIdx;0!==crtIdx;)rndIdx=Math.floor(Math.random()*crtIdx),tmpVal=arr[crtIdx-=1],arr[crtIdx]=arr[rndIdx],arr[rndIdx]=tmpVal;return arr}function uniqueValuesFromArray(anArr){return anArr.filter((function(el,idx,arr){return arr.indexOf(el)===idx}))}function hideEl(elId){docEl(elId).classList.contains("nodisplay")||(docEl(elId).className+=" nodisplay")}function showEl(elId){docEl(elId).className=docEl(elId).className.replace(/(?:^|\s)nodisplay(?!\S)/g,"")}function isNormalInteger(str){var test={},val;return test.val=val,test.bool=!1,(str=str.trim())?(str=str.replace(/^0+/,"")||"0",val=Math.floor(Number(str)),String(val)===str&&val>0&&(test.val=val.toString(),test.bool=!0),test):test}function capitalizeUserName(str){return str.replace(/(?:^|\s)\S/g,(function(a){return a.toUpperCase()}))}function exitErrorInData(){hideEl("errorFbk"),hideEl("errorFbkCancel"),docEl("errorFbk").value="",docEl("reportError").textContent="Report error"}function reportErrorInData(){var errorObj={},reportedEl1To4=Array.from(docEl("canPreviewDiv").querySelectorAll("li.previewSelected")),reportedEl5=Array.from(docEl("bop").querySelectorAll("li.previewSelected")),refUid;if(reportedEl1To4.length)refUid=reportedEl1To4[0],errorObj.task=refUid.parentElement.dataset.task||"unknown";else{if(!reportedEl5.length)return;refUid=reportedEl5[0],errorObj.task="tsk5"}if(docEl("errorFbk").classList.contains("nodisplay"))return docEl("reportError").textContent="Confirm error",void showEl("errorFbk");confirmErrorInData(errorObj,refUid)}function confirmErrorInData(errorObj,refUid){var descr=docEl("errorFbk").value;""!==descr?(errorObj.descr=descr,errorObj.uid=refUid.dataset.uid,errorObj.user=appVoca.settings.user,void 0!==errorObj.uid?pushNewObjToDb(errorObj,"data/pe4/errors/",null,"Thank you! The error was reported."):window.mscAlert({title:"",subtitle:"Cannot identify the record. The error cannot be reported."}),exitErrorInData()):window.mscAlert({title:"",subtitle:"Please describe the issue briefly."})}function createLiForFoo(fooId,uid,eng,book){var container=docEl(fooId),frag=document.createDocumentFragment(),newLi=document.createElement("LI"),newTxtNd=document.createTextNode(eng),newSpan;newLi.className="category",newLi.dataset.uid=uid,newLi.appendChild(newTxtNd),"0"!==book?((newSpan=document.createElement("SPAN")).className="encircled",newSpan.textContent=book,newLi.className+=" purplerain",newLi.appendChild(newSpan)):"foo2"!==fooId&&"bop"!==fooId||((newSpan=document.createElement("SPAN")).textContent=appVoca.texts[uid].tgts.join(", "),newSpan.className+=" t5tgtsList",newLi.appendChild(newSpan)),frag.appendChild(newLi),container.appendChild(frag)}function populateFoo(fooId,dataObj){var dataKeys=Object.keys(dataObj);if("foo2"===fooId)return dataKeys.sort((function(a,b){return dataObj[a].ctx.localeCompare(dataObj[b].ctx)})),void dataKeys.forEach((function(elem){createLiForFoo(fooId,elem,dataObj[elem].ctx.toLocaleUpperCase(),"0")}));dataKeys.sort((function(a,b){return dataObj[a].en.localeCompare(dataObj[b].en)})),dataKeys.forEach((function(el){dataObj[el].hasOwnProperty("allowTsk")&&createLiForFoo(fooId,el,dataObj[el].en,dataObj[el].book)}))}function dropCondition(evt){return-1!==appVoca.data[evt.item.dataset.uid].allowTsk.indexOf(evt.to.dataset.task)}function resetDroppedEl(elItem,elFrom){var elClone=elItem.cloneNode(!0);elItem.parentElement.removeChild(elItem),elFrom.appendChild(elClone),elClone.classList.contains("previewSelected")&&(elClone.className=elClone.className.replace(/(?:^|\s)previewSelected(?!\S)/g,""))}function allowDropOrNo(evt){!0!==dropCondition(evt)&&resetDroppedEl(evt.item,evt.from),evt.stopPropagation()}function makeSortables(){Sortable.create(docEl("foo"),{group:"omega",animation:0,sort:!1,multiDrag:!1}),Sortable.create(docEl("bar"),{group:"omega",animation:0,onEnd:function(evt){clearThisPreviewEl(evt)},onAdd:function(evt){allowDropOrNo(evt)}}),Sortable.create(docEl("baz"),{group:"omega",animation:0,onEnd:function(evt){clearThisPreviewEl(evt)},onAdd:function(evt){allowDropOrNo(evt)}}),Sortable.create(docEl("baz2"),{group:"omega",animation:0,onEnd:function(evt){clearThisPreviewEl(evt)},onAdd:function(evt){allowDropOrNo(evt)}}),Sortable.create(docEl("urbaz"),{group:"omega",animation:0,onEnd:function(evt){clearThisPreviewEl(evt)},onAdd:function(evt){allowDropOrNo(evt)}}),Sortable.create(docEl("colin"),{group:"omega",animation:0,onEnd:function(evt){clearThisPreviewEl(evt)},onAdd:function(evt){allowDropOrNo(evt)}}),Sortable.create(docEl("foo2"),{group:"alpha",animation:0,sort:!1,multiDrag:!1}),Sortable.create(docEl("bop"),{group:"alpha",animation:0,onEnd:function(evt){clearThisPreviewEl(evt)}})}function setExamDate(){var today=new Date,month;today.getUTCMonth()<=5?appVoca.settings.date="Spring "+today.getUTCFullYear():appVoca.settings.date="Fall "+today.getUTCFullYear()}function populateFooFilters(){var container=docEl("foo-filters"),frag=document.createDocumentFragment(),newInput0=document.createElement("INPUT"),newLabel0=document.createElement("Label"),newInput,newLabel;emptyContent(container),newInput0.type="checkbox",newInput0.id="fltrX",newInput0.checked="true",newInput0.dataset.book="0",newLabel0.htmlFor="fltrX",newLabel0.textContent="Not in book",frag.appendChild(newInput0),frag.appendChild(newLabel0),appVoca.settings.bookUnits.forEach((function(el,i){newInput=document.createElement("INPUT"),newLabel=document.createElement("Label"),newInput.type="checkbox",newInput.id="fltr"+i,newInput.checked="true",newInput.dataset.book=el,newLabel.htmlFor="fltr"+i,newLabel.textContent="Unit "+el,frag.appendChild(newInput),frag.appendChild(newLabel)})),container.appendChild(frag)}function setBookFilters(){var dataKeys=Object.keys(appVoca.data);appVoca.settings.bookUnits=dataKeys.map((function(el){return appVoca.data[el].book})).filter((function(el,idx,arr){return arr.indexOf(el)===idx&&void 0!==el&&""!==el&&"0"!==el})),appVoca.settings.bookUnits.sort((function(a,b){return a-b})),populateFooFilters()}function calculateSettings(){setExamDate(),setBookFilters()}function getRelevantElsForFooFilter(els,book){return"0"===book?els.filter((function(el){return!el.classList.contains("purplerain")})):els.filter((function(el){return el.classList.contains("purplerain")&&appVoca.data[el.dataset.uid].book===book}))}function filterVoca(){var els=Array.from(docEl("foo").querySelectorAll("li.category")),chkArr=getChkBoxForVoca(),relvEls;els.forEach((function(el){el.classList.contains("filteredOut")||(el.className+=" filteredOut")})),chkArr.forEach((function(elem){(relvEls=getRelevantElsForFooFilter(els,elem)).forEach((function(eleme){eleme.classList.contains("filteredOut")&&(eleme.className=eleme.className.replace(/(?:^|\s)filteredOut(?!\S)/g,""))}))}))}function getChkBoxForVoca(){var els;return Array.from(docEl("foo-filters").querySelectorAll('input[type="checkbox"]')).filter((function(el){return void 0!==el.dataset.book&&!0===el.checked})).map((function(elem){return elem.dataset.book}))}function previewTsksFromLi(el){el.target!==el.currentTarget&&("LI"===el.target.nodeName&&void 0!==el.target.dataset.uid?triggerPreviewEx(el.target):"SPAN"===el.target.nodeName&&void 0!==el.target.parentElement.dataset.uid&&triggerPreviewEx(el.target.parentElement),el.stopPropagation())}function createTsk1To4PreviewRenderObj(uid,task,isTsk1,refProp){var tgtEn=appVoca.data[uid].en,sourceObj=appVoca.data[uid][refProp][task],renderObj={b4:"",en:"",af:"",opts:{a:"",b:"",c:"",d:""}},isCol=!1,isTsk2=!1;"col"===task?(isCol=!0,renderObj.en=tgtEn,renderObj[sourceObj.pos]="_____",renderObj.opts.a="a. "+sourceObj.dis1+" | "+sourceObj.dis2+" | "+sourceObj.ans1,renderObj.opts.b="b. "+sourceObj.ans2+" | "+sourceObj.ans3+" | "+sourceObj.dis3,renderObj.opts.c="c. "+sourceObj.dis3+" | "+sourceObj.dis1+" | "+sourceObj.dis2,renderObj.opts.d="d. "+sourceObj.ans1+" | "+sourceObj.ans2+" | "+sourceObj.ans3):(renderObj.b4=sourceObj.b4,renderObj.af=sourceObj.af,renderObj.opts.b="b. "+sourceObj.dis1,renderObj.opts.c="c. "+sourceObj.dis2,renderObj.opts.d="d. "+sourceObj.ans,!1===isTsk1?(renderObj.en="_____","syn"===task?isTsk2=!0:"practice"===refProp?(renderObj.opts.a="a. "+sourceObj.dis3,renderObj.opts.d="d. "+tgtEn):renderObj.opts.a="a. "+tgtEn):(renderObj.en=tgtEn,renderObj.opts.a="a. "+sourceObj.dis3)),renderTsk1To4PreviewExmpl(renderObj,isCol,isTsk2,isTsk1,refProp)}function renderTsk5PreviewExamExmpl(uid){var textTxt=appVoca.texts[uid].exam.txt,container=docEl("previewExamExmpl"),frag=document.createDocumentFragment(),newDiv0=document.createElement("DIV");emptyContent(container),newDiv0.textContent=textTxt,frag.appendChild(newDiv0),container.appendChild(frag)}function renderTsk5PreviewPracticeExmpl(uid){var txtPrt1=appVoca.texts[uid].practice.txtPrt1,txtPrt2=appVoca.texts[uid].practice.txtPrt2,container=docEl("previewPracticeExmpl"),frag=document.createDocumentFragment(),newLbl0=document.createElement("LABEL"),newLbl1=document.createElement("LABEL"),newTxtEl0=document.createTextNode(txtPrt1),newTxtEl1=document.createTextNode(txtPrt2),newBr=document.createElement("BR");emptyContent(container),newLbl0.className="label label-xs label-color777",newLbl0.textContent="Practice",newLbl1.className="label label-xs label-color777",newLbl1.textContent="Practice",frag.appendChild(newLbl0),frag.appendChild(newTxtEl0),frag.appendChild(newBr),frag.appendChild(newLbl1),frag.appendChild(newTxtEl1),container.appendChild(frag)}function renderTsk1To4PreviewExmpl(renderObj,isCol,isTsk2,isTsk1,refProp){var container,frag=document.createDocumentFragment(),newDiv0=document.createElement("DIV"),newDiv1=document.createElement("DIV"),newSpan0=document.createElement("SPAN"),newSpan1=document.createElement("SPAN"),newSpan2=document.createElement("SPAN"),newSpan3=document.createElement("SPAN"),newBr,newSpanU,newTxtNd0,newTxtNd1,newLbl0;"exam"===refProp?container=docEl("previewExamExmpl"):(container=docEl("previewPracticeExmpl"),(newLbl0=document.createElement("LABEL")).className="label label-xs label-color777",newLbl0.textContent="Practice",newDiv0.appendChild(newLbl0)),emptyContent(container),!0===isTsk2&&(newDiv1.style.display="none"),newDiv0.className="previewExmplDiv","practice"===refProp&&newDiv0.appendChild(newLbl0),!0===isTsk1?(newSpanU=document.createElement("SPAN"),newTxtNd0=document.createTextNode(renderObj.b4+" "),newTxtNd1=document.createTextNode(" "+renderObj.af),newSpanU.textContent=renderObj.en,newSpanU.style.textDecoration="underline",newDiv0.appendChild(newTxtNd0),newDiv0.appendChild(newSpanU),newDiv0.appendChild(newTxtNd1)):(newTxtNd0=document.createTextNode(renderObj.b4+" "+renderObj.en+" "+renderObj.af),newDiv0.appendChild(newTxtNd0)),newSpan0.className="previewExmplSpan",newSpan1.className="previewExmplSpan",newSpan2.className="previewExmplSpan",newSpan3.className="previewExmplSpan encircled",newSpan0.textContent=renderObj.opts.a,newSpan1.textContent=renderObj.opts.b,newSpan2.textContent=renderObj.opts.c,newSpan3.textContent=renderObj.opts.d,newDiv1.appendChild(newSpan0),newDiv1.appendChild(newSpan1),!0===isCol&&(newBr=document.createElement("BR"),newDiv1.appendChild(newBr)),newDiv1.appendChild(newSpan2),newDiv1.appendChild(newSpan3),frag.appendChild(newDiv0),frag.appendChild(newDiv1),container.appendChild(frag)}function clearThisPreviewEl(evt){evt.item.classList.contains("previewSelected")&&(evt.item.className=evt.item.className.replace(/(?:^|\s)previewSelected(?!\S)/g,""),emptyContent(docEl("previewExamExmpl")),emptyContent(docEl("previewPracticeExmpl")),exitErrorInData()),evt.stopPropagation()}function clearAllPreviewEls(){var els=Array.from(docEl("tsks1To4Divs").querySelectorAll("li.category.previewSelected")),t5Els=Array.from(docEl("tsk5Divs").querySelectorAll("li.category.previewSelected"));els.forEach((function(el){el.className=el.className.replace(/(?:^|\s)previewSelected(?!\S)/g,"")})),t5Els.forEach((function(el){el.className=el.className.replace(/(?:^|\s)previewSelected(?!\S)/g,"")})),emptyContent(docEl("previewExamExmpl")),emptyContent(docEl("previewPracticeExmpl")),exitErrorInData()}function triggerPreviewEx(el){var uid=el.dataset.uid,task=el.parentElement.dataset.task,isTsk1="bar"===el.parentElement.id,isTsk5="bop"===el.parentElement.id,bool=el.classList.contains("previewSelected");clearAllPreviewEls(),void 0!==uid&&(isTsk5||void 0!==task&&appVoca.data[uid].exam.hasOwnProperty(task))&&(bool?el.className=el.className.replace(/(?:^|\s)previewSelected(?!\S)/g,""):(el.className+=" previewSelected",!0!==isTsk5?(createTsk1To4PreviewRenderObj(uid,task,isTsk1,"exam"),createTsk1To4PreviewRenderObj(uid,task,isTsk1,"practice")):(triggerTsk5Borders(el),renderTsk5PreviewExamExmpl(uid),renderTsk5PreviewPracticeExmpl(uid))))}function identifyTsk5Li(el){el.target!==el.currentTarget&&("LI"===el.target.nodeName&&void 0!==el.target.dataset.uid?triggerTsk5Borders(el.target):"SPAN"===el.target.nodeName&&void 0!==el.target.parentElement.dataset.uid&&triggerTsk5Borders(el.target.parentElement),el.stopPropagation())}function triggerTsk5Borders(elTgt){var t5tgtsArr=appVoca.texts[elTgt.dataset.uid].tgts||[];clearAllTsk5Borders(),highlightTsk5VocaInTsks1To4(t5tgtsArr),elTgt.classList.contains("purpleborder")||(elTgt.className+=" purpleborder")}function clearAllTsk5Borders(){var els;Array.from(docEl("fullVocaLists").querySelectorAll("li.category.purpleborder")).forEach((function(el){el.className=el.className.replace(/(?:^|\s)purpleborder(?!\S)/g,"")}))}function highlightTsk5VocaInTsks1To4(tsk5tgtsArr){var els1To4Arr,idx;Array.from(docEl("tsks1To4Divs").querySelectorAll("li.category")).forEach((function(el){-1!==(idx=tsk5tgtsArr.indexOf(appVoca.data[el.dataset.uid].en))&&(el.className+=" purpleborder")}))}function reOrderTskBox(elId){var container=docEl(elId),els=Array.from(container.querySelectorAll("li.category")),elsArrClone=[],elClone;els.length<=1||(els.forEach((function(el){elClone=el.cloneNode(!0),elsArrClone.push(elClone)})),shuffleArray(elsArrClone),emptyContent(container),elsArrClone.forEach((function(el){container.appendChild(el)})))}function reOrderTskBox2(){reOrderTskBox("baz"),reOrderTskBox("baz2")}function switchForReOrderTskBox(elId){switch(elId){case"rTbar":reOrderTskBox("bar");break;case"rTbaz":reOrderTskBox2();break;case"rTurbaz":reOrderTskBox("urbaz");break;case"rTcolin":reOrderTskBox("colin");break;default:return}}function identifyElForTskBoxSwitch(el){"BUTTON"===el.target.nodeName&&switchForReOrderTskBox(el.target.id),el.stopPropagation()}function identifyScreenBtn(el){el.target!==el.currentTarget&&("A"===el.target.nodeName&&void 0!==el.target.dataset.func&&switchForToggleScreenBtns(el.target.dataset.func),el.stopPropagation())}function switchForToggleScreenBtns(func){switch(func){case"gen":chkUserDefForErrors();break;case"prv":showPreviousTests();break;case"edt":clickToggleBetweenEditScreens();break;case"dwl":initSaveAndDownload();break;case"loa":identifyCheckedPreviousTest();break;case"exi":clickToggleBetweenEditScreens();break;case"udp":createOrUpdateNewPendingObj();break;case"exp":leaveRequestScreen();break;default:return}}function repopulateMenu(btnObj){var container=docEl("screenButtons"),frag=document.createDocumentFragment(),newA0=document.createElement("A"),newA1=document.createElement("A");emptyContent(container),newA0.href="#",newA0.className="btn-whitePurple pull-right",newA1.href="#",newA1.className="btn-whitePurple pull-right",newA0.dataset.func=btnObj.a0.func,newA0.textContent=btnObj.a0.txt,newA1.dataset.func=btnObj.a1.func,newA1.textContent=btnObj.a1.txt,frag.appendChild(newA0),frag.appendChild(newA1),container.appendChild(frag)}function clickToggleBetweenEditScreens(){var btnObj={a0:{func:"gen",txt:"GENERATE"},a1:{func:"prv",txt:"PREVIOUS TESTS"}};appVoca.settings.editMode=!0,toggleBetweenScreens(btnObj)}function toggleBetweenScreens(btnObj){var func=btnObj.a0.func;hideAllContainers(),repopulateMenu(btnObj),"gen"!==func?"dwl"!==func?"exp"!==func?"exi"===func&&showEl("fullPrevious"):showEl("fullRequest"):showEl("fullLayout"):showEl("fullVocaLists")}function hideAllContainers(){hideEl("fullRequest"),hideEl("fullPrevious"),hideEl("fullVocaLists"),hideEl("fullLayout")}function chkUserDefForErrors(){var test1=getTypeOfExam(),test2=getVersionOfExam();!1!==test1&&!1!==test2&&chkLiChoices1To4ForUserErrors()}function setUserDef(chkObj){var chkObjKeys=Object.keys(chkObj),tskKeys=["tsk1","tsk2a","tsk2b","tsk3","tsk4","tsk5"],btnObj,newKey;chkObjKeys.forEach((function(oldKey,i){oldKey!==(newKey=tskKeys[i])&&(Object.defineProperty(chkObj,newKey,Object.getOwnPropertyDescriptor(chkObj,oldKey)),delete chkObj[oldKey])})),renderMainExamPreview(chkObj),btnObj={a0:{func:"dwl",txt:"DOWNLOAD"},a1:{func:"edt",txt:"EDIT"}},appVoca.settings.editMode=!1,toggleBetweenScreens(btnObj)}function getUidsOfChildLiNodes(elId){var ndLst;return Array.from(docEl(elId).querySelectorAll("li.category")).map((function(el){return el.dataset.uid})).filter((function(elem){return void 0!==elem}))}function showUserChoiceErrors(num,allowed){var txt;if(!1===num)txt="Please check that each task contains the required number of words!";else{if(!1!==allowed)return;txt="You are attempting to assign some words that are disallowed!"}window.mscAlert({title:"",subtitle:txt})}function chkLiChoices5ForUserErrors(chkObj){var tsks1To4Containers=Object.keys(chkObj),num=!0,allowed=!0,tsk5,eng;chkObj.bop=getUidsOfChildLiNodes("bop"),1===chkObj.bop.length?(tsk5=appVoca.texts[chkObj.bop[0]].tgts,tsks1To4Containers.forEach((function(el){chkObj[el].forEach((function(elem){eng=appVoca.data[elem].en,-1!==tsk5.indexOf(eng)&&(allowed=!1)}))})),!1!==allowed?setUserDef(chkObj):showUserChoiceErrors(!0,allowed)):showUserChoiceErrors(!1,allowed)}function getLiChoices1To4(containers){var chkObj={};return containers.forEach((function(el){chkObj[el]=getUidsOfChildLiNodes(el)})),chkObj}function getVersionOfExam(){var test=isNormalInteger(docEl("examVersion").value);return!1===test.bool?(appVoca.settings.version="",window.mscAlert({title:"",subtitle:"Please select a number for the test version!"})):appVoca.settings.version=test.val,test.bool}function getTypeOfExam(){var test=docEl("examType").options[docEl("examType").selectedIndex].value;return"0"===test?(appVoca.settings.type="",window.mscAlert({title:"",subtitle:"Please choose whether the test is for MIDTERM or FINAL!"}),!1):(appVoca.settings.type=test,!0)}function chkLiChoices1To4ForUserErrors(){var containers=["bar","baz","baz2","urbaz","colin"],chkObj=getLiChoices1To4(containers),num=!0,allowed=!0,task,len;containers.forEach((function(el){len=chkObj[el].length,"baz"!==el&&"baz2"!==el?8!==len&&(num=!1):"baz"===el&&"baz2"===el||4!==len&&(num=!1)})),containers.forEach((function(el){chkObj[el].forEach((function(idx){task=docEl(el).dataset.task,-1===appVoca.data[idx].allowTsk.indexOf(task)&&(allowed=!1)}))})),!1!==num&&!1!==allowed?chkLiChoices5ForUserErrors(chkObj):showUserChoiceErrors(num,allowed)}function mapColDistractors(refObj){var optsObj={};return optsObj.a=refObj.dis1+" | "+refObj.dis2+" | "+refObj.ans1,optsObj.b=refObj.ans2+" | "+refObj.ans3+" | "+refObj.dis3,optsObj.c=refObj.dis3+" | "+refObj.dis1+" | "+refObj.dis2,optsObj.d=refObj.ans1+" | "+refObj.ans2+" | "+refObj.ans3,optsObj}function mapEachTskObj1To4ForExamRender(num,type,el,tsk){var refObj=appVoca.data[el].exam[type],qObj={},optKeys=["a","b","c","d"],tempOpts=[],colOpts,tempAns;return qObj.qnum=num,qObj.qtgt=appVoca.data[el].en,qObj.qb4=refObj.b4,qObj.qaf=refObj.af,"tsk2a"===tsk||"tsk2b"===tsk?(qObj.qtgt="_____",qObj.ans=appVoca.data[el].en):(qObj.opts={},"tsk1"===tsk&&(tempOpts[0]=refObj.dis1,tempOpts[1]=refObj.dis2,tempOpts[2]=refObj.dis3,tempOpts[3]=refObj.ans),"tsk3"===tsk&&(qObj.qtgt="_____",tempOpts[0]=refObj.dis1,tempOpts[1]=refObj.dis2,tempOpts[2]=appVoca.data[el].en,tempOpts[3]=refObj.ans),"tsk4"===tsk&&(qObj.qb4="",qObj.qaf="",qObj["q"+refObj.pos]="_____",colOpts=mapColDistractors(refObj),tempOpts[0]=colOpts.a,tempOpts[1]=colOpts.b,tempOpts[2]=colOpts.c,tempOpts[3]=colOpts.d),tempAns=""+tempOpts[3],shuffleArray(tempOpts),qObj.opts.a=tempOpts[0],qObj.opts.b=tempOpts[1],qObj.opts.c=tempOpts[2],qObj.opts.d=tempOpts[3],qObj.ans=optKeys[tempOpts.indexOf(tempAns)]),qObj}function mapArrOfTskObjs1To4ForExamRender(objRef,tsk,type,numStart){var num=numStart,qArr=[],qObj;return objRef[tsk].forEach((function(el){num++,qObj=mapEachTskObj1To4ForExamRender(num,type,el,tsk),qArr.push(qObj)})),qArr}function mapTsk2AnsPosWithinExamObj(prop){var refObj=appVoca.examObjs.current[prop],tempArr=[],boxObj={},optKeys=["a","b","c","d"];shuffleArray(tempArr=refObj.qstns.map((function(el){return el.ans}))),boxObj.a=tempArr[0],boxObj.b=tempArr[1],boxObj.c=tempArr[2],boxObj.d=tempArr[3],refObj.qstns.forEach((function(el){el.ansPos=""+optKeys[tempArr.indexOf(el.ans)]})),refObj.box=boxObj}function mapTskObj5ForExamRender(objRef,numStart){var refObj=appVoca.texts[objRef.tsk5[0]].exam,optQstns=["q1","q2","q3","q4","q5","q6","q7","q8"],optKeys=["a","b","c","d"],num=numStart,tempOpts=[],qObj={},tempAns,optsObj;return qObj.box=refObj.txt,qObj.qstns=[],optQstns.forEach((function(el){num++,(optsObj={}).qnum=num,optsObj.qb4=refObj[el].qstn,tempOpts[0]=refObj[el].dis1,tempOpts[1]=refObj[el].dis2,tempOpts[2]=refObj[el].dis3,tempOpts[3]=refObj[el].ans,tempAns=""+tempOpts[3],shuffleArray(tempOpts),optsObj.opts={},optsObj.opts.a=tempOpts[0],optsObj.opts.b=tempOpts[1],optsObj.opts.c=tempOpts[2],optsObj.opts.d=tempOpts[3],optsObj.ans=optKeys[tempOpts.indexOf(tempAns)],qObj.qstns.push(optsObj)})),qObj}function clearRenderedExamPreview(){emptyContent(docEl("rendertsk1")),emptyContent(docEl("rendertsk2a")),emptyContent(docEl("rendertsk2b")),emptyContent(docEl("rendertsk3")),emptyContent(docEl("rendertsk4")),emptyContent(docEl("rendertsk5")),emptyContent(docEl("task2aOptBox")),emptyContent(docEl("task2bOptBox")),emptyContent(docEl("task5OptBox"))}function renderMainExamPreview(chkObj){appVoca.examObjs.current={},appVoca.examObjs.currentUids={},appVoca.examObjs.currentUids=chkObj,appVoca.examObjs.current.tsk1=mapArrOfTskObjs1To4ForExamRender(appVoca.examObjs.currentUids,"tsk1","syn",0),appVoca.examObjs.current.tsk2a={},appVoca.examObjs.current.tsk2a.qstns=mapArrOfTskObjs1To4ForExamRender(appVoca.examObjs.currentUids,"tsk2a","syn",8),appVoca.examObjs.current.tsk2b={},appVoca.examObjs.current.tsk2b.qstns=mapArrOfTskObjs1To4ForExamRender(appVoca.examObjs.currentUids,"tsk2b","syn",12),appVoca.examObjs.current.tsk3=mapArrOfTskObjs1To4ForExamRender(appVoca.examObjs.currentUids,"tsk3","gmr",16),appVoca.examObjs.current.tsk4=mapArrOfTskObjs1To4ForExamRender(appVoca.examObjs.currentUids,"tsk4","col",24),appVoca.examObjs.current.tsk5=mapTskObj5ForExamRender(appVoca.examObjs.currentUids,32),mapTsk2AnsPosWithinExamObj("tsk2a"),mapTsk2AnsPosWithinExamObj("tsk2b"),clearRenderedExamPreview(),renderDOMForExamPreview("tsk1",!0,!1),renderDOMForExamPreview("tsk2a",!0,!0),renderDOMForExamPreview("tsk2b",!0,!0),renderDOMForExamPreview("tsk3",!0,!1),renderDOMForExamPreview("tsk4",!1,!1),fragTsk2Box(appVoca.examObjs.current.tsk2a.box,"task2aOptBox"),fragTsk2Box(appVoca.examObjs.current.tsk2b.box,"task2bOptBox"),fragBuild5AndAttach()}function fragBuild5AndAttach(){var container=docEl("rendertsk5"),frag;appVoca.examObjs.current.tsk5.qstns.forEach((function(el){frag=fragQWithFourOpts(el,!1,"tsk5"),container.appendChild(frag)})),docEl("task5OptBox").textContent=appVoca.examObjs.current.tsk5.box}function fragBuildAndAttach(task,qObj,optInline,isTsk2){var elId,container=docEl("render"+task),frag;frag=!1===isTsk2?fragQWithFourOpts(qObj,optInline,task):fragQWithNoOpts(qObj,task),container.appendChild(frag)}function renderDOMForExamPreview(task,bool1,bool2){var tskObj;(tskObj=!0===bool2?appVoca.examObjs.current[task].qstns:appVoca.examObjs.current[task]).forEach((function(el){fragBuildAndAttach(task,el,bool1,bool2)}))}function fragTsk2Box(boxObj,ctnr){var container=docEl(ctnr),frag=document.createDocumentFragment(),span0=document.createElement("SPAN"),span1=document.createElement("SPAN"),span2=document.createElement("SPAN"),span3=document.createElement("SPAN");span0.textContent="(a.) "+boxObj.a,span1.textContent="(b.) "+boxObj.b,span2.textContent="(c.) "+boxObj.c,span3.textContent="(d.) "+boxObj.d,frag.appendChild(span0),frag.appendChild(span1),frag.appendChild(span2),frag.appendChild(span3),container.appendChild(frag)}function fragQWithFourOpts(qObj,bool,task){var frag=document.createDocumentFragment(),div0=document.createElement("DIV"),div1=document.createElement("DIV"),div2=document.createElement("DIV"),div3=document.createElement("DIV"),div4=document.createElement("DIV"),span0=document.createElement("SPAN"),span1=document.createElement("SPAN"),span2=document.createElement("SPAN"),span3=document.createElement("SPAN"),span4=document.createElement("SPAN"),div3a,newSpanU,newTxtNd0,newTxtNd1;return div0.className="row",div1.className="col-lg-12 expand padB6",div2.className="expand","tsk1"===task?(newSpanU=document.createElement("SPAN"),newTxtNd0=document.createTextNode(qObj.qnum+". "+qObj.qb4+" "),newTxtNd1=document.createTextNode(" "+qObj.qaf),newSpanU.textContent=qObj.qtgt,newSpanU.style.textDecoration="underline",div2.appendChild(newTxtNd0),div2.appendChild(newSpanU),div2.appendChild(newTxtNd1)):(div2.textContent=qObj.qnum+". "+qObj.qb4,"tsk5"!==task&&(div2.textContent+=" "+qObj.qtgt+" "+qObj.qaf)),div3.className="answeroptions",div4.className="answergrid",div4.textContent=qObj.qnum+". ",span0.textContent="a. "+qObj.opts.a,span1.textContent="b. "+qObj.opts.b,span2.textContent="c. "+qObj.opts.c,span3.textContent="d. "+qObj.opts.d,span4.className="answerkey hidden-print",span4.textContent=qObj.ans,!1===bool?(div3a=document.createElement("DIV")).className="answeroptions":div3.className+=" pull-left",div3.appendChild(span0),div3.appendChild(span1),!1===bool?(div3a.appendChild(span2),div3a.appendChild(span3)):(div3.appendChild(span2),div3.appendChild(span3)),div4.appendChild(span4),div1.appendChild(div2),div1.appendChild(div3),!1===bool&&div1.appendChild(div3a),div1.appendChild(div4),div0.appendChild(div1),frag.appendChild(div0),frag}function fragQWithNoOpts(qObj){var frag=document.createDocumentFragment(),div0=document.createElement("DIV"),div1=document.createElement("DIV"),div2=document.createElement("DIV"),div3=document.createElement("DIV"),span0=document.createElement("SPAN");return div0.className="row",div1.className="col-lg-12 expand",div2.className="pull-left expand padB16",div2.textContent=qObj.qnum+". "+qObj.qb4+" "+qObj.qtgt+" "+qObj.qaf,div3.className="answergrid",div3.textContent=qObj.qnum+". ",span0.className="answerkey hidden-print",span0.textContent=qObj.ansPos,div3.appendChild(span0),div1.appendChild(div2),div1.appendChild(div3),div0.appendChild(div1),frag.appendChild(div0),frag}function pdfMakePromise(dwnldObjContent){var pdfDocGenerator=pdfMake.createPdf(dwnldObjContent);return new window.Promise((function(resolve){pdfDocGenerator.getBase64((function(pdfBase64){resolve(pdfBase64)}))}))}function pdfObjPromise(dwnldObj){return new window.Promise((function(resolve){pdfMakePromise(dwnldObj.content).then((function(result){dwnldObj.content={},dwnldObj.content.base64=result,resolve(dwnldObj)}))}))}function toAddToZip(pdfObjArr){var allPromises=[];pdfObjArr.forEach((function(pdfObj){allPromises.push(pdfObjPromise(pdfObj))})),window.Promise.all(allPromises).then((function(resolvedArr){makeZipDownloadAndSave(resolvedArr)}))}function downloadSuccessful(){var btnObj={a0:{func:"gen",txt:"GENERATE"},a1:{func:"prv",txt:"PREVIOUS TESTS"}};appVoca.settings.editMode=!0,toggleBetweenScreens(btnObj)}function makeZipDownloadAndSave(resolvedArr){var zip=new JSZip,zipName=getFileName(appVoca.settings.user,appVoca.settings.type,appVoca.settings.version,"zip"),translations=makeTranslationsCsv();resolvedArr.forEach((function(pdfObj){zip.file(pdfObj.name,pdfObj.content.base64,{base64:!0,mimeType:"application/pdf"})})),zip.file("PE4_Translations.csv",translations,{mimeType:"text/csv"}),zip.generateAsync({type:"blob"}).then((function(data){downloadSuccessful(),window.saveAs(data,zipName)}))}function getFileName(user,type,version,ext){return user+"_PE4_VOCA_"+type+"_v"+version+"_"+appVoca.settings.date.replace(" ","")+"."+ext}function initSaveAndDownload(){var test1=getTypeOfExam(),test2=getVersionOfExam();!1!==test1&&!1!==test2&&!0!==appVoca.settings.editMode&&(saveAsNewPreviousTest(),doZipDownload())}function doZipDownload(){var pdfObjArr=[],pdfObjExam={},pdfObjMock={};try{pdfObjExam.content=buildExamDocDefinition(),pdfObjExam.name=getFileName(appVoca.settings.user,appVoca.settings.type,appVoca.settings.version,"pdf"),pdfObjMock.content=buildMockTestDocDefinition(),pdfObjMock.name=getFileName(appVoca.settings.user,"PracticeTests",appVoca.settings.version,"pdf")}catch(e){return void window.mscAlert({title:"",subtitle:"There was an internal error. The test cannot be rendered.\n"+e})}pdfObjArr.push(pdfObjExam),pdfObjArr.push(pdfObjMock),2===pdfObjArr.length&&toAddToZip(pdfObjArr)}function examDocDefShell(){var docDefShell;return{pageSize:"B4",pageOrientation:"landscape",pageMargins:[20,20,10,20],content:[{columns:[[],[]]},{pageBreak:"before",columns:[[],[]]}],styles:{qstnTbl:{margin:[0,0,0,0],fontSize:12},t5nestedTbl:{margin:[4,-5,0,0],fontSize:10},nestedTable:{margin:[8,-5,0,0],fontSize:11},header:{fontSize:14,margin:[4,0,0,0]},subheader:{fontSize:12,margin:[5,0,0,10]},defaultStyle:{columnGap:10}}}}function examDocDefExamHeader(){var arrShell=[],docDefExamHeader={layout:{defaultBorder:!1},table:{body:[[{text:"PE4",fontSize:34,margin:[0,-5,0,0]},{text:[{text:"VOCABULARY "+appVoca.settings.type+" v"+appVoca.settings.version+"\n"},{text:appVoca.settings.user+" "+appVoca.settings.date}]},[{layout:{defaultBorder:!1},table:{body:[[{text:"",margin:[0,-4,0,0]},{text:"Student Name:",fontSize:10,margin:[-4,-5,0,0]},{text:"",margin:[0,-4,0,0]},{text:"Student Number: ",fontSize:10,margin:[-4,-5,0,0]}],[" ",{text:" ",border:[!0,!0,!0,!0]}," ",{text:" ",border:[!0,!0,!0,!0]}]]}}]]]}};return arrShell.push(docDefExamHeader),arrShell}function examDocDefTsk1Header(){var docDefTskHeader=[];return docDefTskHeader[0]={text:"\nTask One",style:"header",bold:!0},docDefTskHeader[1]={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{margin:[0,-3,0,0],bold:!0,text:["Choose the best definition of the ",{text:"underlined",decoration:"underline"}," word"]}]]}}],{width:70,fontSize:8,table:{body:[[{text:"ANSWER",margin:[0,4,0,0],border:[!1,!1,!1,!1]}]]}}]},docDefTskHeader}function examDocDefTsk2Header(prop){var docDefTskHeader=[],box=appVoca.examObjs.current[prop].box,opta="(a.) "+box.a,optb="(b.) "+box.b,optc="(c.) "+box.c,optd="(d.) "+box.d,tskText="\nTask Two (i)";return"tsk2b"===prop&&(tskText="\nTask Two (ii)"),docDefTskHeader[0]={text:tskText,style:"header",bold:!0},docDefTskHeader[1]={text:"Choose a correct word to complete each sentence. CHOOSE EACH WORD ONCE.\n",style:"subheader",bold:!0},docDefTskHeader[2]={width:["*"],margin:[4,0,20,0],style:"qstnTbl",table:{fontSize:12,layout:{defaultBorder:!1},noWrap:!0,widths:["*","*","*","*"],body:[[{text:opta,margin:[2,2,0,0],border:[!0,!0,!1,!0]},{text:optb,margin:[0,2,0,2],border:[!1,!0,!1,!0]},{text:optc,margin:[0,2,0,2],border:[!1,!0,!1,!0]},{text:optd,margin:[0,2,0,2],border:[!1,!0,!0,!0]}]]}},docDefTskHeader[3]={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[]]}}],{width:60,fontSize:8,table:{body:[[{text:"ANSWER",margin:[-4,4,0,0],border:[!1,!1,!1,!1]}]]}}]},docDefTskHeader}function examDocDefTsk3Header(){var docDefTskHeader=[];return docDefTskHeader[0]={text:"Task Three",style:"header",bold:!0},docDefTskHeader[1]={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:"Choose the correct grammar form to complete each sentence.",margin:[0,-3,0,0],bold:!0}]]}}],{width:60,fontSize:8,table:{body:[[{text:"ANSWER",margin:[-4,4,0,0],border:[!1,!1,!1,!1]}]]}}]},docDefTskHeader}function examDocDefTsk4Header(){var docDefTskHeader=[];return docDefTskHeader[0]={text:"Task Four",style:"header",bold:!0},docDefTskHeader[1]={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:"Choose the three strongest collocates to the given word.",margin:[0,-3,0,0],bold:!0}]]}}],{width:60,fontSize:8,table:{body:[[{text:"ANSWER",margin:[-4,4,0,0],border:[!1,!1,!1,!1]}]]}}]},docDefTskHeader}function examDocDefTsk5Header(){var docDefTskHeader=[],txtbox=appVoca.examObjs.current.tsk5.box;return docDefTskHeader[0]={text:"Task Five",style:"header",bold:!0},docDefTskHeader[1]={text:"Read the text below and answer the questions that follow.\n",style:"subheader",bold:!0},docDefTskHeader[2]={width:["*"],margin:[4,0,20,0],style:"qstnTbl",table:{body:[[{style:"qstnTbl",fontSize:11,layout:{defaultBorder:!1},noWrap:!1,table:{body:[[{text:txtbox,margin:[4,4,4,4]}]]}}]]}},docDefTskHeader[3]={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[]]}}],{width:60,fontSize:8,table:{body:[[{text:"ANSWER",margin:[-4,4,0,0],border:[!1,!1,!1,!1]}]]}}]},docDefTskHeader}function examDocDefTsk1Qstns(){var docDefTskQstns=[],refArr=appVoca.examObjs.current.tsk1,len=refArr.length-1,lastBorder,qObj,b4tgt,aftgt,numWithDot,opta,optb,optc,optd;return refArr.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),opta="a. "+el.opts.a,optb="b. "+el.opts.b,optc="c. "+el.opts.c,optd="d. "+el.opts.d,numWithDot=el.qnum+".",b4tgt=numWithDot+" "+el.qb4+" ",aftgt=" "+el.qaf,qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:[b4tgt,{text:el.qtgt,decoration:"underline"},aftgt]}],[{style:"nestedTable",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:opta},{text:optb,margin:[4,0,0,0]},{text:optc,margin:[4,0,0,0]},{text:optd,margin:[4,0,0,0]}]]}}]]}}],{width:70,table:{body:[[{text:numWithDot,margin:[0,0,25,20],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function examDocDefTsk2Qstns(prop){var docDefTskQstns=[],refArr=appVoca.examObjs.current[prop].qstns,len=refArr.length-1,fixWidth,lastBorder,qObj,qstn,numWithDot;return refArr.forEach((function(el,i){lastBorder=!1,fixWidth=18,i===len&&(lastBorder=!0),el.qnum<=9&&(fixWidth=25),numWithDot=el.qnum+".",qstn=numWithDot+" "+el.qb4+" "+el.qtgt+" "+el.qaf,qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,fixWidth,16],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function examDocDefTsk3Qstns(){var docDefTskQstns=[],refArr=appVoca.examObjs.current.tsk3,len=refArr.length-1,lastBorder,qObj,qstn,numWithDot,opta,optb,optc,optd;return refArr.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),opta="a. "+el.opts.a,optb="b. "+el.opts.b,optc="c. "+el.opts.c,optd="d. "+el.opts.d,numWithDot=el.qnum+".",qstn=numWithDot+" "+el.qb4+" "+el.qtgt+" "+el.qaf,qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn],[{style:"nestedTable",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:opta},{text:optb,margin:[4,0,0,0]},{text:optc,margin:[4,0,0,0]},{text:optd,margin:[4,0,0,0]}]]}}]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,18,20],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function examDocDefTsk4Qstns(){var docDefTskQstns=[],refObj=appVoca.examObjs.current.tsk4,len=refObj.length-1,lastBorder,qObj,qstn,numWithDot,opta,optb,optc,optd;return refObj.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),opta="a. "+el.opts.a,optb="b. "+el.opts.b,optc="c. "+el.opts.c,optd="d. "+el.opts.d,numWithDot=el.qnum+".",qstn=numWithDot+" "+el.qb4+" "+el.qtgt+" "+el.qaf,qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn],[{style:"nestedTable",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:opta},{text:optb,margin:[4,0,0,0]}],[{text:optc},{text:optd,margin:[4,0,0,0]}]]}}]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,18,37],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function examDocDefTsk5Qstns(){var docDefTskQstns=[],refArr=appVoca.examObjs.current.tsk5.qstns,len=refArr.length-1,lastBorder,qObj,qstn,numWithDot,opta,optb,optc,optd;return refArr.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),opta="a. "+el.opts.a,optb="b. "+el.opts.b,optc="c. "+el.opts.c,optd="d. "+el.opts.d,numWithDot=el.qnum+".",qstn=numWithDot+" "+el.qb4,qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn],[{style:"t5nestedTbl",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:opta},{text:optb,margin:[4,0,0,0]}],[{text:optc},{text:optd,margin:[4,0,0,0]}]]}}]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,18,37],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function buildExamDocDefinition(){var docDef=examDocDefShell(),pg1Left=[],pg1Right=[],pg2Left=[],pg2Right=[];return pg1Left[0]=examDocDefExamHeader(),pg1Left[1]=examDocDefTsk1Header(),pg1Left[2]=examDocDefTsk1Qstns(),pg1Left[3]=examDocDefTsk2Header("tsk2a"),pg1Left[4]=examDocDefTsk2Qstns("tsk2a"),pg1Right[0]=examDocDefTsk2Header("tsk2b"),pg1Right[1]=examDocDefTsk2Qstns("tsk2b"),pg1Right[2]=examDocDefTsk3Header(),pg1Right[3]=examDocDefTsk3Qstns(),pg2Left[0]=examDocDefTsk4Header(),pg2Left[1]=examDocDefTsk4Qstns(),pg2Right[0]=examDocDefTsk5Header(),pg2Right[1]=examDocDefTsk5Qstns(),pg1Left.forEach((function(elem){elem.forEach((function(el){docDef.content[0].columns[0].push(el)}))})),pg1Right.forEach((function(elem){elem.forEach((function(el){docDef.content[0].columns[1].push(el)}))})),pg2Left.forEach((function(elem){elem.forEach((function(el){docDef.content[1].columns[0].push(el)}))})),pg2Right.forEach((function(elem){elem.forEach((function(el){docDef.content[1].columns[1].push(el)}))})),docDef}function mockTestDocDefShell(){var docDefShell;return{pageSize:"B4",pageOrientation:"landscape",pageMargins:[15,10,10,10],content:[{columns:[[],[]]},{pageBreak:"before",columns:[[],[]]}],styles:{qstnTbl:{margin:[0,0,0,0],fontSize:12},t5nestedTbl:{margin:[4,-5,0,0],fontSize:10},nestedTable:{margin:[8,-5,0,0],fontSize:11},header:{fontSize:14,margin:[4,0,0,0]},subheader:{fontSize:12,margin:[5,0,0,10]},defaultStyle:{columnGap:10}}}}function mockTestDocDefExamHeader(strNum){var arrShell=[],txt,docDefExamHeader={layout:{defaultBorder:!1},margin:[4,0,0,-10],table:{body:[[{text:[{text:"Practice test ("+strNum+") for VOCABULARY "+appVoca.settings.type+" v"+appVoca.settings.version+"\n"},{text:appVoca.settings.user+" "+appVoca.settings.date}]},[{layout:{defaultBorder:!1},table:{body:[[{text:"",margin:[0,-4,0,0]},{text:"Student Name:",fontSize:10,margin:[-4,-5,0,0]},{text:"",margin:[0,-4,0,0]},{text:"Student Number: ",fontSize:10,margin:[-4,-5,0,0]}],[" ",{text:" ",border:[!0,!0,!0,!0]}," ",{text:" ",border:[!0,!0,!0,!0]}]]}}]]]}};return arrShell.push(docDefExamHeader),arrShell}function mockTestDocDefTsk2Header(uidArr){var docDefTskHeader=[],boxArr=uidArr.map((function(el){return appVoca.data[el].en}));return shuffleArray(boxArr),docDefTskHeader[0]={text:"\nTask Two",style:"header",bold:!0,margin:[4,-5,0,0]},docDefTskHeader[1]={text:"Choose a correct word to complete each sentence. CHOOSE EACH WORD ONCE.\n",style:"subheader",bold:!0},docDefTskHeader[2]={width:["*"],margin:[4,0,20,0],style:"qstnTbl",table:{fontSize:12,layout:{defaultBorder:!1},noWrap:!0,widths:["*","*","*","*"],body:[[{text:"(a.) "+boxArr[0],margin:[2,2,0,0],border:[!0,!0,!1,!0]},{text:"(b.) "+boxArr[1],margin:[0,2,0,2],border:[!1,!0,!1,!0]},{text:"(c.) "+boxArr[2],margin:[0,2,0,2],border:[!1,!0,!1,!0]},{text:"(d.) "+boxArr[3],margin:[0,2,0,2],border:[!1,!0,!0,!0]}]]}},docDefTskHeader[3]={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[]]}}],{width:60,fontSize:8,table:{body:[[{text:"ANSWER",margin:[-4,4,0,0],border:[!1,!1,!1,!1]}]]}}]},docDefTskHeader}function mockTestDocDefTsk5Header(prop){var docDefTskHeader=[],txtbox=appVoca.texts[appVoca.examObjs.currentUids.tsk5[0]].practice[prop];return docDefTskHeader[0]={text:"Task Five",style:"header",bold:!0,margin:[4,10,0,0]},docDefTskHeader[1]={text:"Read the text below and answer the questions that follow.\n",style:"subheader",bold:!0},docDefTskHeader[2]={width:["*"],margin:[4,0,20,0],style:"qstnTbl",table:{body:[[{style:"qstnTbl",fontSize:11,layout:{defaultBorder:!1},noWrap:!1,table:{body:[[{text:txtbox,margin:[4,4,4,4]}]]}}]]}},docDefTskHeader[3]={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[]]}}],{width:60,fontSize:8,table:{body:[[{text:"ANSWER",margin:[-4,4,0,0],border:[!1,!1,!1,!1]}]]}}]},docDefTskHeader}function mockTestDocDefTsk1Qstns(uidArr){var docDefTskQstns=[],refArr=uidArr.map((function(el){return appVoca.data[el].practice.syn})),len=refArr.length-1,lastBorder,qObj,tgt,b4tgt,aftgt,qnum,numWithDot,optsArr;return refArr.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),numWithDot=(qnum=i+1)+".",tgt=appVoca.data[uidArr[i]].en,b4tgt=numWithDot+" "+el.b4+" ",aftgt=" "+el.af,shuffleArray(optsArr=[el.dis1,el.dis2,el.dis3,el.ans]),qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:[b4tgt,{text:tgt,decoration:"underline"},aftgt]}],[{style:"nestedTable",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:"a. "+optsArr[0]},{text:"b. "+optsArr[1],margin:[4,0,0,0]},{text:"c. "+optsArr[2],margin:[4,0,0,0]},{text:"d. "+optsArr[3],margin:[4,0,0,0]}]]}}]]}}],{width:70,table:{body:[[{text:numWithDot,margin:[0,0,25,20],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function mockTestDocDefTsk2Qstns(uidArr){var docDefTskQstns=[],refArr=uidArr.map((function(el){return appVoca.data[el].practice.syn})),len=refArr.length-1,lastBorder,qObj,qnum,qstn,numWithDot;return refArr.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),qstn=(numWithDot=(qnum=i+5)+".")+" "+el.b4+" _____ "+el.af,qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,25,16],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function mockTestDocDefTsk3Qstns(uidArr){var docDefTskQstns=[],refArr=uidArr.map((function(el){return appVoca.data[el].practice.gmr})),len=refArr.length-1,fixWidth,lastBorder,qObj,tgt,qstn,qnum,numWithDot,optsArr;return refArr.forEach((function(el,i){lastBorder=!1,fixWidth=18,i===len&&(lastBorder=!0),(qnum=i+9)<=9&&(fixWidth=25),numWithDot=qnum+".",tgt=appVoca.data[uidArr[i]].en,qstn=numWithDot+" "+el.b4+" _____ "+el.af,shuffleArray(optsArr=[el.dis1,el.dis2,el.dis3,tgt]),qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn],[{style:"nestedTable",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:"a. "+optsArr[0]},{text:"b. "+optsArr[1],margin:[4,0,0,0]},{text:"c. "+optsArr[2],margin:[4,0,0,0]},{text:"d. "+optsArr[3],margin:[4,0,0,0]}]]}}]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,fixWidth,20],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function mockTestDocDefTsk4Qstns(uidArr){var docDefTskQstns=[],refObj=uidArr.map((function(el){return appVoca.data[el].practice.col})),len=refObj.length-1,lastBorder,qObj,mappedCols,qstn,qnum,numWithDot,optsArr;return refObj.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),numWithDot=(qnum=i+13)+".",qstn="b4"===el.pos?numWithDot+" _____ "+appVoca.data[uidArr[i]].en:numWithDot+" "+appVoca.data[uidArr[i]].en+" _____ ",mappedCols=mapColDistractors(el),shuffleArray(optsArr=[mappedCols.a,mappedCols.b,mappedCols.c,mappedCols.d]),qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn],[{style:"nestedTable",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:"a. "+optsArr[0]},{text:"b. "+optsArr[1],margin:[4,0,0,0]}],[{text:"c. "+optsArr[2]},{text:"d. "+optsArr[3],margin:[4,0,0,0]}]]}}]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,18,37],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function mockTestDocDefTsk5Qstns(num){var docDefTskQstns=[],refObj=appVoca.texts[appVoca.examObjs.currentUids.tsk5[0]].practice,refArr,len,lastBorder,qObj,qnum,qstn,numWithDot,optsArr;return refArr=1===num?[refObj.q1,refObj.q2,refObj.q3,refObj.q4]:[refObj.q5,refObj.q6,refObj.q7,refObj.q8],len=refArr.length-1,refArr.forEach((function(el,i){lastBorder=!1,i===len&&(lastBorder=!0),qstn=(numWithDot=(qnum=i+17)+".")+" "+el.qstn,shuffleArray(optsArr=[el.dis1,el.dis2,el.dis3,el.ans]),qObj={columns:[[{style:"qstnTbl",width:["*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[qstn],[{style:"t5nestedTbl",widths:["*","*","*","*"],noWrap:!0,layout:{defaultBorder:!1},table:{body:[[{text:"a. "+optsArr[0]},{text:"b. "+optsArr[1],margin:[4,0,0,0]}],[{text:"c. "+optsArr[2]},{text:"d. "+optsArr[3],margin:[4,0,0,0]}]]}}]]}}],{width:65,table:{body:[[{text:numWithDot,margin:[0,0,18,37],border:[!0,!0,!0,lastBorder]}]]}}]},docDefTskQstns[i]=qObj})),docDefTskQstns}function buildMockTestDocDefinition(){var docDef=mockTestDocDefShell(),pg1Left=[],pg1Right=[],pg2Left=[],pg2Right=[],randTsk1wordOrder=shuffleArray(appVoca.examObjs.currentUids.tsk1.slice(0)),randTsk2a_wordOrder=shuffleArray(appVoca.examObjs.currentUids.tsk2a.slice(0)),randTsk2b_wordOrder=shuffleArray(appVoca.examObjs.currentUids.tsk2b.slice(0)),randTsk3wordOrder=shuffleArray(appVoca.examObjs.currentUids.tsk3.slice(0)),randTsk4wordOrder=shuffleArray(appVoca.examObjs.currentUids.tsk4.slice(0));return pg1Left[0]=mockTestDocDefExamHeader("1"),pg1Left[1]=examDocDefTsk1Header(),pg1Left[2]=mockTestDocDefTsk1Qstns(randTsk1wordOrder.slice(0,4)),pg1Left[3]=mockTestDocDefTsk2Header(randTsk2a_wordOrder),pg1Left[4]=mockTestDocDefTsk2Qstns(randTsk2a_wordOrder),pg1Left[5]=examDocDefTsk3Header(),pg1Left[6]=mockTestDocDefTsk3Qstns(randTsk3wordOrder.slice(0,4)),pg1Right[0]=examDocDefTsk4Header(),pg1Right[1]=mockTestDocDefTsk4Qstns(randTsk4wordOrder.slice(0,4)),pg1Right[2]=mockTestDocDefTsk5Header("txtPrt1"),pg1Right[3]=mockTestDocDefTsk5Qstns(1),pg2Left[0]=mockTestDocDefExamHeader("2"),pg2Left[1]=examDocDefTsk1Header(),pg2Left[2]=mockTestDocDefTsk1Qstns(randTsk1wordOrder.slice(4)),pg2Left[3]=mockTestDocDefTsk2Header(randTsk2b_wordOrder),pg2Left[4]=mockTestDocDefTsk2Qstns(randTsk2b_wordOrder),pg2Left[5]=examDocDefTsk3Header(),pg2Left[6]=mockTestDocDefTsk3Qstns(randTsk3wordOrder.slice(4)),pg2Right[0]=examDocDefTsk4Header(),pg2Right[1]=mockTestDocDefTsk4Qstns(randTsk4wordOrder.slice(4)),pg2Right[2]=mockTestDocDefTsk5Header("txtPrt2"),pg2Right[3]=mockTestDocDefTsk5Qstns(2),pg1Left.forEach((function(elem){elem.forEach((function(el){docDef.content[0].columns[0].push(el)}))})),pg1Right.forEach((function(elem){elem.forEach((function(el){docDef.content[0].columns[1].push(el)}))})),pg2Left.forEach((function(elem){elem.forEach((function(el){docDef.content[1].columns[0].push(el)}))})),pg2Right.forEach((function(elem){elem.forEach((function(el){docDef.content[1].columns[1].push(el)}))})),docDef}function getKeysGivenArrOfValuesViaProp(prop,valsArr){var keys;return Object.keys(appVoca.data).filter((function(el){return-1!==valsArr.indexOf(appVoca.data[el][prop])}))}function getTranslationsArr(){var tsks1To4=["tsk1","tsk2a","tsk2b","tsk3","tsk4"],tsk5=getKeysGivenArrOfValuesViaProp("en",appVoca.texts[appVoca.examObjs.currentUids.tsk5[0]].tgts),enKrArr=[],enKrObj,refObj;return tsks1To4.forEach((function(elem){appVoca.examObjs.currentUids[elem].forEach((function(el){refObj=appVoca.data[el],(enKrObj={}).en=refObj.en,enKrObj.kr=refObj.practice.kr,enKrObj.ctxKr=refObj.practice.ctxKr,-1!==refObj.allowTsk.indexOf("syn")?enKrObj.ctxEn=refObj.practice.syn.b4+" "+refObj.en+" "+refObj.practice.syn.af:enKrObj.ctxEn="",enKrArr.push(enKrObj)}))})),tsk5.forEach((function(el){refObj=appVoca.data[el],(enKrObj={}).en=refObj.en,enKrObj.kr=refObj.practice.kr,enKrObj.ctxKr=refObj.practice.ctxKr,enKrObj.ctxEn=refObj.practice.syn.b4+" "+refObj.en+" "+refObj.practice.syn.af,enKrArr.push(enKrObj)})),enKrArr}function makeTranslationsCsv(){var enKrArr=getTranslationsArr(),tsv='"TRANSLATIONS"\r\n"'+appVoca.settings.user+" Vocabulary "+appVoca.settings.type+" v."+appVoca.settings.version+" "+appVoca.settings.date+'"\r\n"EN"\t"KR"\t"contextEN"\t"contextKR"\r\n';return enKrArr.forEach((function(el){tsv+='"'+el.en+'"\t"'+el.kr+'"\t"'+el.ctxEn+'"\t"'+el.ctxKr+'"\r\n'})),tsv}function saveAsNewPreviousTest(){var path="data/pe4/"+firebase.auth().currentUser.uid+"/examObjs/",newTestObj={};newTestObj.def=appVoca.examObjs.currentUids,newTestObj.type=appVoca.settings.type,newTestObj.version=appVoca.settings.version,newTestObj.user=appVoca.settings.user,newTestObj.date=appVoca.settings.date,newTestObj.timeStamp=Date.now(),pushNewObjToDb(newTestObj,path,appVoca.examObjs.previous,"The exam has been saved successfully.")}function populatePreviousTests(){var container=docEl("previousExamsContainer"),prvsKeys=Object.keys(appVoca.examObjs.previous),prvsObj,timeStr,frag=document.createDocumentFragment(),newDiv0,newInput0,newLbl0,newSpan0;emptyContent(container),prvsKeys.length?prvsKeys.forEach((function(el,i){newDiv0=document.createElement("DIV"),newInput0=document.createElement("INPUT"),newLbl0=document.createElement("LABEL"),newSpan0=document.createElement("SPAN"),prvsObj=appVoca.examObjs.previous[el],timeStr=new Date(prvsObj.timeStamp).toLocaleString(),newInput0.type="radio",newInput0.id="prEx"+i,newInput0.name="prvsDrone",newInput0.value=el,newLbl0.htmlFor="prEx"+i,newLbl0.textContent=" "+prvsObj.type+" v"+prvsObj.version+" "+prvsObj.date+" - "+timeStr,newSpan0.className="btn btn-xs btn-default pdeL-btn",newSpan0.textContent="X",newSpan0.dataset.uid=el,newDiv0.appendChild(newInput0),newDiv0.appendChild(newLbl0),newDiv0.appendChild(newSpan0),frag.appendChild(newDiv0)})):((newDiv0=document.createElement("DIV")).textContent="No previously saved exams.",frag.appendChild(newDiv0)),container.appendChild(frag)}function showPreviousTests(){var btnObj={a0:{func:"exi",txt:"EXIT"},a1:{func:"loa",txt:"LOAD SELECTED"}};populatePreviousTests(),appVoca.settings.editMode=!0,toggleBetweenScreens(btnObj)}function identifyDeletePreviousTestEl(el){el.target!==el.currentTarget&&("SPAN"===el.target.nodeName&&void 0!==el.target.dataset.uid&&triggerDeletePreviousTest(el.target.dataset.uid),el.stopPropagation())}function triggerDeletePreviousTest(testUid){deletePreviousTestFromDb(testUid)}function identifyCheckedPreviousTest(){var els=Array.from(docEl("previousExamsContainer").querySelectorAll("input[type='radio']:checked")),uid;els.length&&(uid=els[0].value,clearAllPreviewEls(),loadCheckedPreviousTest(appVoca.examObjs.previous[uid].def),clickToggleBetweenEditScreens())}function loadCheckedPreviousTest(refObj){var vocaDataKeys=Object.keys(appVoca.data),vocaTextsKeys=Object.keys(appVoca.texts),prvsObj={},keyMap=[{a:"tsk1",b:"syn",c:"bar"},{a:"tsk2a",b:"syn",c:"baz"},{a:"tsk2b",b:"syn",c:"baz2"},{a:"tsk3",b:"gmr",c:"urbaz"},{a:"tsk4",b:"col",c:"colin"}],els;Array.from(docEl("foo-filters").querySelectorAll('input[type="checkbox"]')).forEach((function(chkBx){chkBx.checked=!0})),keyMap.forEach((function(elem,i){prvsObj[elem.a]=refObj[elem.a].filter((function(el){return void 0!==appVoca.data[el]&&-1!==appVoca.data[el].allowTsk.indexOf(keyMap[i].b)})),vocaDataKeys=vocaDataKeys.filter((function(ex){return-1===prvsObj[elem.a].indexOf(ex)}))})),prvsObj.tsk5=refObj.tsk5.filter((function(el){return void 0!==appVoca.texts[el]})),vocaTextsKeys=vocaTextsKeys.filter((function(ex){return-1===prvsObj.tsk5.indexOf(ex)})),renderCheckedPreviousTest(prvsObj,vocaTextsKeys,vocaDataKeys,keyMap)}function resetFooContainers(){emptyContent(docEl("foo2")),emptyContent(docEl("foo")),emptyContent(docEl("bar")),emptyContent(docEl("baz")),emptyContent(docEl("baz2")),emptyContent(docEl("urbaz")),emptyContent(docEl("colin")),emptyContent(docEl("bop"))}function renderCheckedPreviousTest(prvsObj,vocaTextsKeys,vocaDataKeys,keyMap){resetFooContainers(),vocaTextsKeys.forEach((function(el){createLiForFoo("foo2",el,appVoca.texts[el].ctx.toLocaleUpperCase(),"0")})),vocaDataKeys.forEach((function(el){createLiForFoo("foo",el,appVoca.data[el].en,appVoca.data[el].book)})),keyMap.forEach((function(elem,i){prvsObj[elem.a].forEach((function(el){createLiForFoo(keyMap[i].c,el,appVoca.data[el].en,appVoca.data[el].book)}))})),prvsObj.tsk5.length&&createLiForFoo("bop",prvsObj.tsk5[0],appVoca.texts[prvsObj.tsk5[0]].ctx.toLocaleUpperCase(),"0")}function newWordRequest(){hideEl("examType"),hideEl("spanB4examVersion"),hideEl("examVersion"),hideEl("currentDate"),makePendingWordMenuBtns(),newReqHandlersOn()}function exitNewWordRequest(){newReqHandlersOff(),showEl("examType"),showEl("spanB4examVersion"),showEl("examVersion"),showEl("currentDate"),clickToggleBetweenEditScreens()}function makePendingWordMenuBtns(){var btnObj={a0:{func:"exp",txt:"EXIT"},a1:{func:"udp",txt:"SAVE EDIT"}};appVoca.settings.editMode=!0,toggleBetweenScreens(btnObj)}function getAllInputsForNewWordRequest(newTarget){var newDataObj={book:"",en:newTarget,exam:{syn:{},gmr:{},col:{}},practice:{kr:"",ctxKr:"",syn:{},gmr:{},col:{}}};return newDataObj.book=getBkUnitOfNewRequest(),newDataObj.exam.syn=mapValuesFromRequestSyn(newDataObj.exam.syn,getValuesFromRequestInputs("requestSyn-exam"),"exam"),newDataObj.practice.syn=mapValuesFromRequestSyn(newDataObj.practice.syn,getValuesFromRequestInputs("requestSyn-practice"),"practice"),newDataObj.practice.kr=getValuesFromRequestInputs("requestSyn-practice")[6]||"",newDataObj.practice.ctxKr=getValuesFromRequestInputs("requestSyn-practice")[7]||"",newDataObj.exam.gmr=mapValuesFromRequestGmr(newDataObj.exam.gmr,getValuesFromRequestInputs("requestGmr-exam"),"exam"),newDataObj.practice.gmr=mapValuesFromRequestGmr(newDataObj.practice.gmr,getValuesFromRequestInputs("requestGmr-practice"),"practice"),newDataObj.exam.col=mapValuesFromRequestCol(newDataObj.exam.col,getValuesFromRequestInputs("requestCol-exam")),newDataObj.practice.col=mapValuesFromRequestCol(newDataObj.practice.col,getValuesFromRequestInputs("requestCol-practice")),newDataObj}function getBkUnitOfNewRequest(){var test=isNormalInteger(docEl("newTargetBkUnit").value);return!1===test.bool&&(test.val="0"),test.val}function getValuesFromRequestInputs(container){var els=Array.from(docEl(container).querySelectorAll("input[type='text']"));return els=els.map((function(el){return el.value}))}function mapValuesFromRequestSyn(refObj,els){var keys,len;return refObj.b4=els[0].charAt(0).toUpperCase()+els[0].slice(1)||"",refObj.af=els[1]||"",(len=refObj.af.length)&&"?"!==refObj.af.charAt(len-1)&&"."!==refObj.af.charAt(len-1)&&(refObj.af=refObj.af+"."),refObj.dis1=els[2]||"",refObj.dis2=els[3]||"",refObj.dis3=els[4]||"",refObj.ans=els[5]||"",(keys=Object.keys(refObj)).forEach((function(el){refObj[el]=refObj[el].replace(/[\s\t]+/," ").replace(/^\s+|\s+$/g,"")})),refObj}function mapValuesFromRequestGmr(refObj,els,dest){var keys,len;return refObj.b4=els[0].charAt(0).toUpperCase()+els[0].slice(1)||"",refObj.af=els[1]||"",(len=refObj.af.length)&&"?"!==refObj.af.charAt(len-1)&&"."!==refObj.af.charAt(len-1)&&(refObj.af=refObj.af+"."),"practice"===dest&&(refObj.dis3=els[2]||""),refObj.dis1=els[3]||"",refObj.dis2=els[4]||"","exam"===dest&&(refObj.ans=els[5]||""),(keys=Object.keys(refObj)).forEach((function(el){refObj[el]=refObj[el].replace(/[\s\t]+/," ").replace(/^\s+|\s+$/g,"")})),refObj}function mapValuesFromRequestCol(refObj,els){var keys;return refObj.pos="b4",docEl("colPos1").checked&&(refObj.pos="af"),refObj.dis1=els[0]||"",refObj.dis2=els[1]||"",refObj.dis3=els[2]||"",refObj.ans1=els[3]||"",refObj.ans2=els[4]||"",refObj.ans3=els[5]||"",(keys=Object.keys(refObj)).forEach((function(el){refObj[el]=refObj[el].replace(/[\s\t]+/," ").replace(/^\s+|\s+$/g,"")})),refObj}function basicChksForNewTarget(newTarget){var chkObj={bool:!1,errorMsg:"",isExam:!1},cleanTarget,isInDb;return(cleanTarget=(newTarget=newTarget.toLowerCase().replace(/[\s\t]+/," ")).replace(/[^a-zA-Z\s]/g,""))!==newTarget?(chkObj.errorMsg="Please use English alphabet characters only.",chkObj):""===(newTarget=newTarget.replace(/[^a-zA-Z\s]/g,"").replace(/^\s+|\s+$/g,""))?(chkObj.errorMsg="Please enter a word in English.",chkObj):((isInDb=Object.keys(appVoca.data).filter((function(el){return appVoca.data[el].en===newTarget}))||[]).length?(!0===appVoca.settings.isMod&&(chkObj.bool=!0),chkObj.isExam=!0,chkObj.errorMsg="The word you are requesting is already in the database."):chkObj.bool=!0,chkObj)}function allowTskChkboxesAreChecked(){var chkd=!1,mapArr;return["modSynAllowTsk","modGmrAllowTsk","modColAllowTsk"].forEach((function(el){!0===docEl(el).childNodes[0].checked&&(chkd=!0)})),chkd}function finalizeNewExamObj(newExamObj){var mapObj={syn:"modSynAllowTsk",gmr:"modGmrAllowTsk",col:"modColAllowTsk"};return newExamObj.allowTsk=["syn","gmr","col"],Object.keys(mapObj).forEach((function(el){!1===docEl(mapObj[el]).childNodes[0].checked&&(newExamObj.allowTsk.splice(newExamObj.allowTsk.indexOf(el),1),delete newExamObj[el])})),newExamObj}function tgtExistsInCtx(ctxStr,tgtStr){if(!tgtStr.length||!ctxStr.length)return!1;var tgtLwr=tgtStr.toLowerCase(),ctxLwr=ctxStr.toLowerCase();return new RegExp("\\b"+tgtLwr+"\\b").test(ctxLwr)}function wordExistsInSentence(ctxStr,tgtArr){var exists=!1;return tgtArr.forEach((function(el){tgtExistsInCtx(ctxStr,el)&&(exists=!0)})),exists}function rigorousModChksForSyn(newExamObj){var chkSyn=!0,tempArr=[],isUnique,ctxStr,tgtArr;return""===newExamObj.exam.syn.af&&(chkSyn=!1),""===newExamObj.practice.syn.af&&(chkSyn=!1),-1!==(tempArr=[newExamObj.exam.syn.dis1,newExamObj.exam.syn.dis2,newExamObj.exam.syn.dis3,newExamObj.exam.syn.ans,newExamObj.practice.syn.dis1,newExamObj.practice.syn.dis2,newExamObj.practice.syn.dis3,newExamObj.practice.syn.ans]).indexOf("")&&(chkSyn=!1),-1!==tempArr.indexOf(newExamObj.en)&&(chkSyn=!1),isUnique=uniqueValuesFromArray(tempArr),tempArr.length!==isUnique.length&&(chkSyn=!1),!0===wordExistsInSentence(ctxStr=newExamObj.exam.syn.b4+" "+newExamObj.exam.syn.af,tgtArr=[newExamObj.en,newExamObj.exam.syn.ans])&&(chkSyn=!1),!0===wordExistsInSentence(ctxStr=newExamObj.practice.syn.b4+" "+newExamObj.practice.syn.af,tgtArr=[newExamObj.en,newExamObj.practice.syn.ans])&&(chkSyn=!1),chkSyn}function rigorousModChksForGmr(newExamObj){var chkGmr=!0,tempArr=[],isUnique,ctxStr,tgtArr;return""===newExamObj.exam.gmr.af&&(chkGmr=!1),""===newExamObj.practice.gmr.af&&(chkGmr=!1),tempArr=[newExamObj.exam.gmr.dis1,newExamObj.exam.gmr.dis2,newExamObj.exam.gmr.ans],newExamObj.exam.gmr.ans!==newExamObj.practice.gmr.dis3&&(chkGmr=!1),newExamObj.exam.gmr.dis1!==newExamObj.practice.gmr.dis1&&newExamObj.exam.gmr.dis1!==newExamObj.practice.gmr.dis2&&(chkGmr=!1),newExamObj.exam.gmr.dis2!==newExamObj.practice.gmr.dis1&&newExamObj.exam.gmr.dis2!==newExamObj.practice.gmr.dis2&&(chkGmr=!1),-1!==tempArr.indexOf("")&&(chkGmr=!1),-1!==tempArr.indexOf(newExamObj.en)&&(chkGmr=!1),isUnique=uniqueValuesFromArray(tempArr),tempArr.length!==isUnique.length&&(chkGmr=!1),!0===wordExistsInSentence(ctxStr=newExamObj.exam.gmr.b4+" "+newExamObj.exam.gmr.af,tgtArr=[newExamObj.en,newExamObj.exam.gmr.ans])&&(chkGmr=!1),!0===wordExistsInSentence(ctxStr=newExamObj.practice.gmr.b4+" "+newExamObj.practice.gmr.af,tgtArr=[newExamObj.en,newExamObj.practice.gmr.dis3])&&(chkGmr=!1),chkGmr}function rigorousModChksForCol(newExamObj){var chkCol=!0,tempArr=[],isUnique;return"b4"!==newExamObj.exam.col.pos&&"af"!==newExamObj.exam.col.pos&&(chkCol=!1),"b4"!==newExamObj.practice.col.pos&&"af"!==newExamObj.practice.col.pos&&(chkCol=!1),isUnique=uniqueValuesFromArray(tempArr=[newExamObj.exam.col.dis1,newExamObj.exam.col.dis2,newExamObj.exam.col.dis3,newExamObj.exam.col.ans1,newExamObj.exam.col.ans2,newExamObj.exam.col.ans3,newExamObj.practice.col.dis1,newExamObj.practice.col.dis2,newExamObj.practice.col.dis3,newExamObj.practice.col.ans1,newExamObj.practice.col.ans2,newExamObj.practice.col.ans3]),tempArr.length!==isUnique.length&&(chkCol=!1),-1!==tempArr.indexOf("")&&(chkCol=!1),-1!==tempArr.indexOf(newExamObj.en)&&(chkCol=!1),chkCol}function modChksForNewTargetUpgradeToExam(newExamObj){var chkVal=!0;return!!newExamObj.hasOwnProperty("allowTsk")&&(!!newExamObj.allowTsk.length&&(""!==newExamObj.en&&(-1!==newExamObj.allowTsk.indexOf("syn")&&!1===rigorousModChksForSyn(newExamObj)&&(chkVal=!1),-1!==newExamObj.allowTsk.indexOf("gmr")&&!1===rigorousModChksForGmr(newExamObj)&&(chkVal=!1),-1!==newExamObj.allowTsk.indexOf("col")&&!1===rigorousModChksForCol(newExamObj)&&(chkVal=!1),chkVal)))}function getChkdStateOfResolvedErrs(refErrObj){var chkBxArr;return Array.from(docEl("errorInfo").querySelectorAll("input[type='checkbox']")).forEach((function(el){refErrObj[el.dataset.errUid]={},refErrObj[el.dataset.errUid].resolved=el.checked})),refErrObj}function modToSaveChangesToEditedExamWord(newTarget){var allowChkbxChkd,rigorousChks,newExamObj,uid;!1!==allowTskChkboxesAreChecked()?(rigorousChks=modChksForNewTargetUpgradeToExam(newExamObj=finalizeNewExamObj(getAllInputsForNewWordRequest(newTarget))),void 0!==(uid=Object.keys(appVoca.data).filter((function(el){return appVoca.data[el]&&appVoca.data[el].en===newTarget}))[0])&&(appVoca.data[uid].hasOwnProperty("hasError")&&(newExamObj.hasError=getChkdStateOfResolvedErrs(appVoca.data[uid].hasError)),!0===rigorousChks?window.mscConfirm({title:"",subtitle:"Do you want to update this exam word?",cancelText:"Cancel",onOk:function(){overwriteExistingExamObjInDb(uid,newExamObj)},onCancel:function(){}}):window.mscAlert({title:"",subtitle:"There are some issues in the data for the tasks you are attempting to add to the exam.\nPlease check carefully for errors and\nplease use the study guide if you are unsure about the necessary restrictions placed on new vocabulary."}))):window.mscAlert({title:"",subtitle:"Please ensure that at least one task checkbox is checked!\nIf your intent is to remove the word from the exam, please delete it from the list."})}function modUpgradePendingToExamWordOrNewExamWord(newTarget){var user=firebase.auth().currentUser.displayName,rigorousChks,newExamObj,uid;rigorousChks=modChksForNewTargetUpgradeToExam(newExamObj=finalizeNewExamObj(getAllInputsForNewWordRequest(newTarget))),uid=Object.keys(appVoca.pending.userCreated).filter((function(el){return appVoca.pending.userCreated[el]&&appVoca.pending.userCreated[el].en===newTarget}))[0],!0===rigorousChks?window.mscConfirm({title:"",subtitle:"Do you want this word to be available on the exam?",cancelText:"No, not yet!",onOk:function(){modCreateNewExamObj(uid,newExamObj)},onCancel:function(){delete newExamObj.allowTsk,clearAllowTskBfgChkboxes(),modSaveUpdatesToPendingWord(newTarget,user)}}):window.mscAlert({title:"",subtitle:"There are some issues in the data for the tasks you are attempting to add to the exam.\nPlease check carefully for errors and\nplease use the study guide if you are unsure about the necessary restrictions placed on new vocabulary."})}function modCreatesOrUpdatesNewPendingObj(newTarget,basicChks){var user=firebase.auth().currentUser.displayName,allowChkbxChkd=allowTskChkboxesAreChecked();!0===basicChks.isExam?modToSaveChangesToEditedExamWord(newTarget):!0===allowChkbxChkd?modUpgradePendingToExamWordOrNewExamWord(newTarget):modSaveUpdatesToPendingWord(newTarget,user)}function modSaveUpdatesToPendingWord(newTarget,user){var isPending=Object.keys(appVoca.pending.userCreated).filter((function(el){return appVoca.pending.userCreated[el].en===newTarget}))||[],newPendingObj=getAllInputsForNewWordRequest(newTarget),existingUid;newPendingObj.lastModBy=user,isPending.length?updateExistingPendingInDb(newPendingObj,existingUid=isPending[0],!0):(newPendingObj.requestBy=user,pushNewObjToDb(newPendingObj,"data/pe4/pending/",appVoca.pending.userCreated,"Thank you for your contribution!"))}function createOrUpdateNewPendingObj(){var newTarget=docEl("newTargetWord").value,basicChks=basicChksForNewTarget(newTarget);!1!==basicChks.bool?!0===appVoca.settings.isMod?modCreatesOrUpdatesNewPendingObj(newTarget,basicChks):updateEditsToNewPendingObj(newTarget):window.mscAlert({title:"",subtitle:basicChks.errorMsg})}function updateEditsToNewPendingObj(newTarget){var user=firebase.auth().currentUser.displayName,isPending=Object.keys(appVoca.pending.userCreated).filter((function(el){return appVoca.pending.userCreated[el].en===newTarget}))||[],newPendingObj=getAllInputsForNewWordRequest(newTarget),existingUid;newPendingObj.lastModBy=user,isPending.length?updateExistingPendingInDb(newPendingObj,existingUid=isPending[0],!0):(newPendingObj.requestBy=user,pushNewObjToDb(newPendingObj,"data/pe4/pending/",appVoca.pending.userCreated,"Thank you for your contribution!"))}function updatenGmrTgt0Drone(){var val=docEl("nGmrTgt0").value;docEl("pGmrTgt0").value=val}function updatenGmrTgt1Drone(){var val=docEl("nGmrTgt1").value;docEl("pGmrTgt1").value=val}function updatenGmrTgt2Drone(){var val=docEl("nGmrTgt2").value;docEl("pGmrTgt2").value=val}function pullColLeft(){docEl("nTgt4").classList.contains("pull-left")||(docEl("nTgt4").className+=" pull-left"),docEl("nTgt5").classList.contains("pull-left")||(docEl("nTgt5").className+=" pull-left")}function leaveColRight(){docEl("nTgt4").className=docEl("nTgt4").className.replace(/(?:^|\s)pull-left(?!\S)/g,""),docEl("nTgt5").className=docEl("nTgt5").className.replace(/(?:^|\s)pull-left(?!\S)/g,"")}function updateTargetWordDrones(){var val=docEl("newTargetWord").value;docEl("nTgt0").textContent=val,docEl("nTgt1").textContent=val,docEl("nTgt2").value=val,docEl("nTgt3").value=val,docEl("nTgt4").textContent=val,docEl("nTgt5").textContent=val,chkForHighlightedPendingWordInList()}function keyUpOnNewTargetWord(evt){updateTargetWordDrones(),searchPendingListElForMatch(evt.target.value),!0===appVoca.settings.isMod&&(clearAllowTskBfgChkboxes(),clearErrorInfo())}function renderLoadingSelectedPendingWordRequestInfo(refObj){var container=docEl("errorInfo"),frag=document.createDocumentFragment(),newDiv=document.createElement("DIV"),newSpan0=document.createElement("SPAN");emptyContent(container),newDiv.className="col-lg-12",newSpan0.style.color="#333",newSpan0.textContent="Requested by: "+refObj.requestBy+" / Last edited by: "+refObj.lastModBy,newDiv.appendChild(newSpan0),frag.appendChild(newDiv),container.appendChild(frag)}function clearErrorInfo(){docEl("errorInfo").hasChildNodes()&&emptyContent(docEl("errorInfo"))}function resetAllInputsForUpdatedPending(){var containers=["requestSyn-exam","requestSyn-practice","requestGmr-exam","requestGmr-practice","requestCol-exam","requestCol-practice"];docEl("newTargetWord").value="",docEl("newTargetBkUnit").value="",updateTargetWordDrones(),containers.forEach((function(el){clearInputsForUpdatedPending(el)}))}function clearInputsForUpdatedPending(container){var els;Array.from(docEl(container).querySelectorAll("input[type='text']")).forEach((function(el){el.value=""}))}function populatePendingList(){var user=firebase.auth().currentUser.uid,uidsArr=Object.keys(appVoca.pending.userCreated),container=docEl("pendingList"),frag=document.createDocumentFragment(),newDiv,newSpan,modCache,pendingCache;emptyContent(container),pendingCache=uidsArr.map((function(el){return appVoca.pending.userCreated[el].en})),!0===appVoca.settings.isMod?(modCache=Object.keys(appVoca.data).map((function(el){return appVoca.data[el].en})),appVoca.pending.enCache=[pendingCache,modCache].reduce((function(acc,val){return acc.concat(val)}),[]).filter((function(el,idx,arr){return arr.indexOf(el)===idx}))):appVoca.pending.enCache=pendingCache,uidsArr.forEach((function(el){(newDiv=document.createElement("DIV")).className="btn btn-sm btn-default btn-block",newDiv.dataset.uid=el,newDiv.textContent=appVoca.pending.userCreated[el].en,!0!==appVoca.settings.isMod&&user!==appVoca.pending.userCreated[el].requestBy||((newSpan=document.createElement("SPAN")).dataset.uid=el,newSpan.className="btn btn-xs btn-default absR-btn",newSpan.textContent="X",newDiv.appendChild(newSpan)),frag.appendChild(newDiv)})),container.appendChild(frag),!0!==appVoca.settings.isMod&&touchPendingListElForMatch()}function identifyPendingListEl(el){if(el.target!==el.currentTarget){if("DIV"===el.target.nodeName&&void 0!==el.target.dataset.uid)return void pendingListElIsWordBtn(el.target);if("SPAN"===el.target.nodeName&&void 0!==el.target.parentElement.dataset.uid)return void pendingListElIsDeleteSpan(el.target.parentElement);el.stopPropagation()}}function pendingListElIsWordBtn(el){"currentVocaErrors"!==el.parentElement.id?"pendingList"===el.parentElement.id&&loadSelectedPendingWord(el,!1):loadSelectedPendingWord(el,!0)}function pendingListElIsDeleteSpan(elParent){"pendingList"!==elParent.parentElement.id?"currentVocaErrors"===elParent.parentElement.id&&window.mscConfirm({title:"Warning",subtitle:'The exam word will be moved to "awaiting moderation"\nand will not be available on the exam. Proceed?',cancelText:"Cancel",onOk:function(){downgradeExamWordIntoPendingList(elParent,elParent.dataset.uid)},onCancel:function(){}}):deletePendingListEl(elParent.dataset.uid)}function populateSynInputsLoadingPendingWord(refObj){var els;(els=Array.from(docEl("requestSyn-exam").querySelectorAll("input[type='text']")))[0].value=refObj.exam.syn.b4,els[1].value=refObj.exam.syn.af,els[2].value=refObj.exam.syn.dis1,els[3].value=refObj.exam.syn.dis2,els[4].value=refObj.exam.syn.dis3,els[5].value=refObj.exam.syn.ans,(els=Array.from(docEl("requestSyn-practice").querySelectorAll("input[type='text']")))[0].value=refObj.practice.syn.b4,els[1].value=refObj.practice.syn.af,els[2].value=refObj.practice.syn.dis1,els[3].value=refObj.practice.syn.dis2,els[4].value=refObj.practice.syn.dis3,els[5].value=refObj.practice.syn.ans,els[6].value=refObj.practice.kr,els[7].value=refObj.practice.ctxKr}function populateGmrInputsLoadingPendingWord(refObj){var els;(els=Array.from(docEl("requestGmr-exam").querySelectorAll("input[type='text']")))[0].value=refObj.exam.gmr.b4,els[1].value=refObj.exam.gmr.af,els[2].value=refObj.en,els[3].value=refObj.exam.gmr.dis1,els[4].value=refObj.exam.gmr.dis2,els[5].value=refObj.exam.gmr.ans,(els=Array.from(docEl("requestGmr-practice").querySelectorAll("input[type='text']")))[0].value=refObj.practice.gmr.b4,els[1].value=refObj.practice.gmr.af,els[2].value=refObj.exam.gmr.ans,els[3].value=refObj.exam.gmr.dis1,els[4].value=refObj.exam.gmr.dis2,els[5].value=refObj.en}function populateColInputsLoadingPendingWord(refObj){var els;"b4"===refObj.exam.col.pos?(docEl("colPos0").checked=!0,leaveColRight()):(docEl("colPos1").checked=!0,pullColLeft()),(els=Array.from(docEl("requestCol-exam").querySelectorAll("input[type='text']")))[0].value=refObj.exam.col.dis1,els[1].value=refObj.exam.col.dis2,els[2].value=refObj.exam.col.dis3,els[3].value=refObj.exam.col.ans1,els[4].value=refObj.exam.col.ans2,els[5].value=refObj.exam.col.ans3,(els=Array.from(docEl("requestCol-practice").querySelectorAll("input[type='text']")))[0].value=refObj.practice.col.dis1,els[1].value=refObj.practice.col.dis2,els[2].value=refObj.practice.col.dis3,els[3].value=refObj.practice.col.ans1,els[4].value=refObj.practice.col.ans2,els[5].value=refObj.practice.col.ans3}function loadSelectedPendingWord(el,bool){var refObj;clearForNewPendingWord(),el.className+=" previewSelected",appVoca.pending.isSelected.pending=!1,appVoca.pending.isSelected.exam=!1,!1===bool?(refObj=appVoca.pending.userCreated[el.dataset.uid],appVoca.pending.isSelected.pending=!0,populateSynInputsLoadingPendingWord(refObj),populateGmrInputsLoadingPendingWord(refObj),populateColInputsLoadingPendingWord(refObj),renderLoadingSelectedPendingWordRequestInfo(refObj)):(refObj=appVoca.data[el.dataset.uid],appVoca.pending.isSelected.exam=!0,-1!==refObj.allowTsk.indexOf("syn")&&populateSynInputsLoadingPendingWord(refObj),-1!==refObj.allowTsk.indexOf("gmr")&&populateGmrInputsLoadingPendingWord(refObj),-1!==refObj.allowTsk.indexOf("col")&&populateColInputsLoadingPendingWord(refObj),finishLoadingSelectedExamWord(refObj)),docEl("newTargetWord").value=refObj.en,docEl("newTargetBkUnit").value="0"===refObj.book?"":refObj.book,docEl("nTgt0").textContent=refObj.en,docEl("nTgt1").textContent=refObj.en,docEl("nTgt2").textContent=refObj.en,docEl("nTgt3").textContent=refObj.en,docEl("nTgt4").textContent=refObj.en,docEl("nTgt5").textContent=refObj.en}function clearHighlightedPendingWords(){var els=Array.from(docEl("awaitingBucket").querySelectorAll("div.previewSelected"));appVoca.pending.isSelected.pending=!1,appVoca.pending.isSelected.exam=!1,els.forEach((function(elem){elem.className=elem.className.replace(/(?:^|\s)previewSelected(?!\S)/g,"")}))}function chkForHighlightedPendingWordInList(){!1===appVoca.pending.isSelected.pending&&!1===appVoca.pending.isSelected.exam||clearHighlightedPendingWords()}function clearForNewPendingWord(){resetAllInputsForUpdatedPending(),clearHighlightedPendingWords(),!0===appVoca.settings.isMod&&(clearAllowTskBfgChkboxes(),clearErrorInfo())}function leaveRequestScreen(){clearForNewPendingWord(),exitNewWordRequest()}function searchPendingListElForMatch(tgtEn){var idx;!0!==appVoca.pending.isSelected.pending&&!0!==appVoca.pending.isSelected.exam&&-1!==(idx=appVoca.pending.enCache.indexOf(tgtEn))&&foundMatchInPendingListEl(tgtEn)}function foundMatchInPendingListEl(tgtEn){var canExit=!1,refkey,els,len,i;for(refkey=Object.keys(appVoca.pending.userCreated).filter((function(el){return appVoca.pending.userCreated[el].en===tgtEn}))[0],len=(els=Array.from(docEl("pendingList").querySelectorAll("div.btn"))).length,i=0;i<len;i++)if(refkey===els[i].dataset.uid){highlightMatchInPendingList(els[i],"pending"),canExit=!0;break}if(!0!==canExit)for(refkey=Object.keys(appVoca.data).filter((function(el){return appVoca.data[el].en===tgtEn}))[0],len=(els=Array.from(docEl("currentVocaErrors").querySelectorAll("div.btn"))).length,i=0;i<len;i++)if(refkey===els[i].dataset.uid){highlightMatchInPendingList(els[i],"exam");break}}function highlightMatchInPendingList(el,prop){appVoca.pending.isSelected[prop]=!0,el.className+=" previewSelected",scrollToEl(el)}function scrollToEl(el){document.body.scrollIntoView&&el.scrollIntoView()}function deletePendingListEl(uid){var user=firebase.auth().currentUser.uid,refObj=appVoca.pending.userCreated[uid],refTgtWord=""+refObj.en;refObj.requestBy!==user&&!0!==appVoca.settings.isMod||window.mscConfirm({title:"Warning",subtitle:"This action will permanently delete the word and all its data. Proceed?",cancelText:"Cancel",onOk:function(){updateExistingPendingInDb(null,uid,!1),docEl("newTargetWord").value===refTgtWord&&(docEl("newTargetWord").value="",updateTargetWordDrones())},onCancel:function(){}})}function createColDistractors(){var keys,colDisArr;populateColDistractors(Object.keys(appVoca.data).map((function(elem){return[appVoca.data[elem].exam.col.dis1,appVoca.data[elem].exam.col.dis2,appVoca.data[elem].exam.col.dis3,appVoca.data[elem].practice.col.dis1,appVoca.data[elem].practice.col.dis2,appVoca.data[elem].practice.col.dis3]})).reduce((function(acc,val){return acc.concat(val)}),[]).filter((function(el,idx,arr){return arr.indexOf(el)===idx&&void 0!==el&&""!==el})).sort((function(a,b){return a.localeCompare(b)})))}function populateColDistractors(colDisArr){var container=docEl("reqSectionAllCols"),frag=document.createDocumentFragment(),newDiv;colDisArr.forEach((function(el){(newDiv=document.createElement("DIV")).className="btn btn-xs btn-default",newDiv.textContent=el,frag.appendChild(newDiv)})),container.appendChild(frag)}function identifyColDisSelected(el){el.target!==el.currentTarget&&toggleSelectedOnColDis(el.target),el.stopPropagation()}function toggleSelectedOnColDis(el){el.classList.contains("selectedColDis")?el.className=el.className.replace(/(?:^|\s)selectedColDis(?!\S)/g,""):el.className+=" selectedColDis"}function loadSelectedColDistractors(){var els=Array.from(docEl("reqSectionAllCols").querySelectorAll("div.btn.selectedColDis")),examTgts=Array.from(docEl("requestCol-exam").querySelectorAll("input[type='text']")).splice(0,3),practiceTgts=Array.from(docEl("requestCol-practice").querySelectorAll("input[type='text']")).splice(0,3);examTgts.forEach((function(el){els.length&&""===el.value&&(el.value=els[0].textContent,els.splice(0,1))})),practiceTgts.forEach((function(el){els.length&&""===el.value&&(el.value=els[0].textContent,els.splice(0,1))})),exitColDistractors()}function viewColDistractors(){hideEl("fullRequest"),hideEl("screenButtons"),showEl("reqAllColDistractors")}function exitColDistractors(){var els;Array.from(docEl("reqSectionAllCols").querySelectorAll("div.btn.selectedColDis")).forEach((function(el){el.classList.contains("selectedColDis")&&(el.className=el.className.replace(/(?:^|\s)selectedColDis(?!\S)/g,""))})),hideEl("reqAllColDistractors"),showEl("screenButtons"),showEl("fullRequest")}function pushNewObjToDb(newObj,path,saveToObj,msg){var newPostKey=firebase.database().ref().child(path).push().key,updates={};updates[path+newPostKey]=newObj,firebase.database().ref().update(updates,(function(e){e?chkPermission(e):(null!==saveToObj&&(saveToObj[newPostKey]=newObj),window.mscAlert({title:"",subtitle:msg}),"data/pe4/pending/"===path&&(null!==newObj&&(appVoca.settings.refresh.uid=newPostKey,appVoca.settings.refresh.cat="pending"),populatePendingList()),"data/pe4/errors/"===path&&!0===appVoca.settings.isMod&&refreshVocaFromDbForMod())}))}function deletePreviousTestFromDb(testUid){var userUid,updates={};updates["data/pe4/"+firebase.auth().currentUser.uid+"/examObjs/"+testUid]=null,firebase.database().ref().update(updates,(function(e){e?chkPermission(e):(delete appVoca.examObjs.previous[testUid],window.mscAlert({title:"",subtitle:"The previous test was deleted."}),populatePreviousTests())}))}function updateExistingPendingInDb(newObj,uid,bool){var updates={};null!==newObj&&newObj.hasOwnProperty("allowTsk")&&delete newObj.allowTsk,updates["data/pe4/pending/"+uid]=newObj,firebase.database().ref().update(updates,(function(e){if(e)chkPermission(e);else{if(!0===bool)return appVoca.pending.userCreated[uid]=newObj,void window.mscAlert({title:"",subtitle:"Thank you for your contribution!"});!1===bool&&(delete appVoca.pending.userCreated[uid],window.mscAlert({title:"",subtitle:"The requested word has been deleted."})),populatePendingList()}}))}function chkPermission(e){var user,updates;"PERMISSION_DENIED"===e.code&&((user=firebase.auth().currentUser)?((updates={})["newUser/pe4/"+user.uid]=user.displayName,firebase.database().ref().update(updates).then(signOutOfApp())):signOutOfApp())}function getPendingVocaFromDb(){firebase.database().ref("data/pe4/pending").once("value").then((function(snapshot){appVoca.pending.userCreated=snapshot.val()||{},populatePendingList()}),(function(e){chkPermission(e)}))}function getPreviousExamsFromDb(){var uid=firebase.auth().currentUser.uid;firebase.database().ref("data/pe4/"+uid+"/examObjs").once("value").then((function(snapshot){appVoca.examObjs.previous=snapshot.val()||{}}),(function(e){chkPermission(e)}))}function getVocaFromDb(){var pe4exams;firebase.database().ref("data/pe4/exams").once("value").then((function(snapshot){null!==(pe4exams=snapshot.val())&&(appVoca.data=pe4exams.ledata||{},appVoca.texts=pe4exams.letexts||{},hasModAccess(),getPreviousExamsFromDb(),getPendingVocaFromDb(),createColDistractors(),startApp())}),(function(e){initFailed(e)}))}function hasModAccess(){var uid=firebase.auth().currentUser.uid,tchrObj;firebase.database().ref("tchrList/pe4/"+uid+"/").once("value").then((function(snapshot){(tchrObj=snapshot.val()||{}).hasOwnProperty("isMod")&&(getReportedErrors(),appVoca.settings.isMod=tchrObj.isMod,docEl("newVocaBtn").textContent="Edit vocabulary",renderModEditingAllowTskChkboxes(),showEl("currentVocaErrorsHdr"),showEl("currentVocaErrors"))}),(function(e){chkPermission(e)}))}function getReportedErrors(){firebase.database().ref("data/pe4/errors").once("value").then((function(snapshot){appVoca.errorObjs=snapshot.val()||{},mapErrorsToAppVocaData(appVoca.errorObjs)}),(function(e){chkPermission(e)}))}function refreshVocaFromDbForMod(){var pe4exams;firebase.database().ref("data/pe4/exams").once("value").then((function(snapshot){null!==(pe4exams=snapshot.val())&&(appVoca.data=pe4exams.ledata||{},appVoca.texts=pe4exams.letexts||{}),firebase.database().ref("data/pe4/pending").once("value").then((function(snapshot){appVoca.pending.userCreated=snapshot.val()||{},populatePendingList(),getReportedErrors()}),(function(e){chkPermission(e)}))}),(function(e){chkPermission(e)}))}function overwriteExistingExamObjInDb(uid,newExamObj){var updates={},errKeys,errUid;newExamObj.hasOwnProperty("allowTsk")&&newExamObj.allowTsk.length&&(newExamObj.hasOwnProperty("hasError")&&((errKeys=Object.keys(newExamObj.hasError)).forEach((function(el){!0===newExamObj.hasError[el].resolved&&(updates["data/pe4/errors/"+(errUid=""+el)]=null,delete newExamObj.hasError[el])})),0===Object.keys(newExamObj.hasError).length&&delete newExamObj.hasError),updates["data/pe4/exams/ledata/"+uid]=newExamObj,firebase.database().ref().update(updates,(function(e){e?chkPermission(e):(window.mscAlert({title:"",subtitle:"The exam has been updated!"}),void 0!==newExamObj.hasError&&renderLoadingSelectedExamWordHasError(newExamObj),touchFooContainersToRemoveEl(uid,!1),appVoca.settings.refresh.uid=uid,appVoca.settings.refresh.cat="exam",refreshVocaFromDbForMod())})))}function modCreateNewExamObj(uid,newExamObj){var updates={},newPostKey;newExamObj.hasOwnProperty("allowTsk")&&newExamObj.allowTsk.length&&(void 0!==uid&&(updates["data/pe4/pending/"+uid]=null),updates["data/pe4/exams/ledata/"+(newPostKey=firebase.database().ref().child("data/pe4/exams/ledata/").push().key)]=newExamObj,firebase.database().ref().update(updates,(function(e){e?chkPermission(e):(window.mscAlert({title:"",subtitle:"The exam has been updated!"}),touchFooContainersToAddEl(newPostKey,newExamObj.en,newExamObj.book),appVoca.settings.refresh.uid=newPostKey,appVoca.settings.refresh.cat="exam",refreshVocaFromDbForMod())})))}function touchPendingListElForMatch(){var uid=appVoca.settings.refresh.uid,cat=appVoca.settings.refresh.cat,elId,els,len,i;if("exam"===cat||"pending"===cat){for("exam"===cat&&(elId="currentVocaErrors"),"pending"===cat&&(elId="pendingList"),len=(els=Array.from(docEl(elId).querySelectorAll("div.btn"))).length,i=0;i<len;i++)if(uid===els[i].dataset.uid){highlightMatchInPendingList(els[i],cat);break}appVoca.settings.refresh.uid="",appVoca.settings.refresh.cat=""}}function downgradeExistingExamObjInDb(uid,newPendingObj){var updates={},newPostKey,errKeys,errUid;newPendingObj.hasOwnProperty("allowTsk")||(newPendingObj.hasOwnProperty("hasError")&&((errKeys=Object.keys(newPendingObj.hasError)).forEach((function(el){updates["data/pe4/errors/"+(errUid=""+el)]=null})),delete newPendingObj.hasError),newPostKey=firebase.database().ref().child("data/pe4/pending/").push().key,updates["data/pe4/pending/"+newPostKey]=newPendingObj,updates["data/pe4/exams/ledata/"+uid]=null,firebase.database().ref().update(updates,(function(e){e?chkPermission(e):(window.mscAlert({title:"",subtitle:"The exam has been updated!"}),touchFooContainersToRemoveEl(uid,!0),clearAllowTskBfgChkboxes(),clearErrorInfo(),appVoca.settings.refresh.uid=newPostKey,appVoca.settings.refresh.cat="pending",refreshVocaFromDbForMod())})))}function downgradeExamWordIntoPendingList(elParent,uid){var isTsk5tgt=wordIsTsk5Tgt(appVoca.data[uid].en),newPendingObj;if(elParent.style.display="none",!0===isTsk5tgt)return elParent.style.display="block",void window.mscAlert({title:"",subtitle:"The word cannot be removed from the exam because it is being used in task 5!"});downgradeExistingExamObjInDb(uid,newPendingObj=finalizeNewDowngradedExamObj(appVoca.data[uid]))}function finalizeNewDowngradedExamObj(refObj){var user=firebase.auth().currentUser.displayName,newPendingObj=JSON.parse(JSON.stringify(refObj));return delete newPendingObj.allowTsk,newPendingObj.requestBy=user,newPendingObj.lastModBy=user,newPendingObj.exam.hasOwnProperty("syn")||(newPendingObj.exam.syn={af:"",ans:"",b4:"",dis1:"",dis2:"",di3:""}),newPendingObj.practice.hasOwnProperty("syn")||(newPendingObj.practice.syn={af:"",ans:"",b4:"",dis1:"",dis2:"",di3:""}),newPendingObj.exam.hasOwnProperty("gmr")||(newPendingObj.exam.gmr={af:"",ans:"",b4:"",dis1:"",dis2:""}),newPendingObj.practice.hasOwnProperty("gmr")||(newPendingObj.practice.gmr={af:"",b4:"",dis1:"",dis2:"",di3:""}),newPendingObj.exam.hasOwnProperty("col")||(newPendingObj.exam.col={pos:"",ans1:"",ans2:"",ans3:"",dis1:"",dis2:"",di3:""}),newPendingObj.practice.hasOwnProperty("col")||(newPendingObj.practice.col={pos:"",ans1:"",ans2:"",ans3:"",dis1:"",dis2:"",di3:""}),newPendingObj}function wordIsTsk5Tgt(propEn){var textKeys=Object.keys(appVoca.texts),bool=!1;return textKeys.forEach((function(el){-1!==appVoca.texts[el].tgts.indexOf(propEn)&&(bool=!0)})),bool}function finishLoadingSelectedExamWord(refObj){var mapObj={syn:"modSynAllowTsk",gmr:"modGmrAllowTsk",col:"modColAllowTsk"},containerKeys=Object.keys(mapObj);refObj.hasOwnProperty("hasError")&&renderLoadingSelectedExamWordHasError(refObj),containerKeys.forEach((function(el){-1!==refObj.allowTsk.indexOf(el)&&refObj.exam.hasOwnProperty(el)&&(docEl(mapObj[el]).childNodes[0].checked=!0)}))}function clearAllowTskBfgChkboxes(){docEl("modSynAllowTsk").childNodes[0].checked=!1,docEl("modGmrAllowTsk").childNodes[0].checked=!1,docEl("modColAllowTsk").childNodes[0].checked=!1}function renderLoadingSelectedExamWordHasError(refObj){var container=docEl("errorInfo"),errKeys=Object.keys(refObj.hasError),frag=document.createDocumentFragment(),newDiv,newSpan0,newSpan1,newBr,newInput,newLabel;emptyContent(container),errKeys.forEach((function(el,i){newDiv=document.createElement("DIV"),newSpan0=document.createElement("SPAN"),newSpan1=document.createElement("SPAN"),newBr=document.createElement("BR"),newInput=document.createElement("INPUT"),newLabel=document.createElement("LABEL"),newDiv.className="col-lg-12",newSpan0.textContent="*Possible error ",newSpan1.textContent=calcErrorTaskTxtContent(appVoca.errorObjs[el].task)+" "+appVoca.errorObjs[el].user+' reports: "'+appVoca.errorObjs[el].descr+'"',newInput.type="checkbox",newInput.id="errResolvChkbx-"+i,newInput.checked=refObj.hasError[el].resolved,newInput.dataset.errUid=el,newInput.style.marginRight="5px",newLabel.htmlFor="errResolvChkbx-"+i,newLabel.textContent="Resolve",newDiv.appendChild(newSpan0),newDiv.appendChild(newSpan1),newDiv.appendChild(newBr),newDiv.appendChild(newInput),newDiv.appendChild(newLabel),frag.appendChild(newDiv)})),container.appendChild(frag)}function calcErrorTaskTxtContent(tskStr){var mappd;return{syn:"in Task 1/Task 2 (synomyms/sentences). ",gmr:"in Task 3 (grammar). ",col:"in Task 4 (collocations). "}[tskStr]||""}function mapErrorsToAppVocaData(refObj){var keys=Object.keys(refObj),tgtObj;keys.length?(keys.forEach((function(el){void 0!==(tgtObj=appVoca.data[refObj[el].uid])&&(tgtObj.hasOwnProperty("hasError")||(tgtObj.hasError={}),tgtObj.hasError[el]={resolved:!1})})),populateModeratorList()):populateModeratorList()}function populateModeratorList(){var uids=Object.keys(appVoca.data).sort((function(a,b){return appVoca.data[a].en.localeCompare(appVoca.data[b].en)})),container=docEl("currentVocaErrors"),frag=document.createDocumentFragment(),uidsWithErrorsArr,uidsOkArr,newDiv,newSpan;emptyContent(container),uidsWithErrorsArr=uids.filter((function(el){return appVoca.data[el].hasOwnProperty("hasError")})),uidsOkArr=uids.filter((function(el){return!appVoca.data[el].hasOwnProperty("hasError")})),uidsWithErrorsArr.forEach((function(el){newDiv=document.createElement("DIV"),newSpan=document.createElement("SPAN"),newDiv.className="btn btn-sm btn-error btn-block",newDiv.dataset.uid=el,newDiv.textContent="*"+appVoca.data[el].en,newSpan.dataset.uid=el,newSpan.className="btn btn-xs btn-default absR-btn",newSpan.textContent="X",newDiv.appendChild(newSpan),frag.appendChild(newDiv)})),uidsOkArr.forEach((function(el){newDiv=document.createElement("DIV"),newSpan=document.createElement("SPAN"),newDiv.className="btn btn-sm btn-default btn-block",newDiv.dataset.uid=el,newDiv.textContent=appVoca.data[el].en,newSpan.dataset.uid=el,newSpan.className="btn btn-xs btn-default absR-btn",newSpan.textContent="X",newDiv.appendChild(newSpan),frag.appendChild(newDiv)})),container.appendChild(frag),touchPendingListElForMatch()}function renderModEditingAllowTskChkboxes(){var containers,frag,newInput;["modSynAllowTsk","modGmrAllowTsk","modColAllowTsk"].forEach((function(el){frag=document.createDocumentFragment(),(newInput=document.createElement("INPUT")).type="checkbox",frag.appendChild(newInput),docEl(el).appendChild(frag)}))}function touchFooContainersToAddEl(newPostKey,eng,book){var tgtUid;createLiForFoo("foo",""+newPostKey,eng,book)}function touchFooContainersToRemoveEl(uid,bool){var tgtUid=""+uid,tgtEl=Array.from(docEl("tsks1To4Divs").querySelectorAll("li.category")).filter((function(el){return el.dataset.uid===tgtUid}))[0];void 0!==tgtEl&&(tgtEl.classList.contains("previewSelected")&&(emptyContent(docEl("previewExamExmpl")),emptyContent(docEl("previewPracticeExmpl")),exitErrorInData()),!0===bool?tgtEl.parentElement.removeChild(tgtEl):tgtEl.className=tgtEl.className.replace(/(?:^|\s)previewSelected(?!\S)/g,""))}function setDatesForClssFilters(){var today=Date.now(),before,future=today+13148719167;return{a:new Date(today-13148719167).toISOString().substring(0,10),b:new Date(future).toISOString().substring(0,10)}}function renderClssFilters(clsses){var container=docEl("cls-filters"),frag=document.createDocumentFragment(),defaultDates=setDatesForClssFilters(),newBtn0,newDiv0=document.createElement("DIV"),newInput0=document.createElement("INPUT"),newLbl0=document.createElement("LABEL"),newInput1=document.createElement("INPUT"),newLbl1=document.createElement("LABEL"),newInput2=document.createElement("INPUT"),newLbl2=document.createElement("LABEL"),newInput3=document.createElement("INPUT"),newInput4=document.createElement("INPUT");clsses.forEach((function(el){(newBtn0=document.createElement("BUTTON")).dataset.cls=el,newBtn0.className="btn btn-xs btn-onlineClss",newBtn0.textContent=el,frag.appendChild(newBtn0)})),newDiv0.className="cls-filter-tsks",newInput0.type="radio",newInput0.id="cFd0",newInput0.name="clsFltrDrone",newInput0.value="syn",newInput0.checked="true",newLbl0.htmlFor="cFd0",newLbl0.textContent="Task I, II",newInput1.type="radio",newInput1.id="cFd1",newInput1.name="clsFltrDrone",newInput1.value="gmr",newLbl1.htmlFor="cFd1",newLbl1.textContent="Task III",newInput2.type="radio",newInput2.id="cFd2",newInput2.name="clsFltrDrone",newInput2.value="col",newLbl2.htmlFor="cFd2",newLbl2.textContent="Task IV",newInput3.type="date",newInput3.value=defaultDates.a,newInput4.type="date",newInput4.value=defaultDates.b,newDiv0.appendChild(newInput0),newDiv0.appendChild(newLbl0),newDiv0.appendChild(newInput1),newDiv0.appendChild(newLbl1),newDiv0.appendChild(newInput2),newDiv0.appendChild(newLbl2),newDiv0.appendChild(newInput3),newDiv0.appendChild(newInput4),frag.appendChild(newDiv0),container.appendChild(frag)}function triggerClssFilters(arr){var dataKeys,clsses,tempEnArr;arr.length&&(dataKeys=Object.keys(appVoca.data),appVoca.practiceArr=arr.map((function(el){return{en:el.en,forClss:el.forClss,availFrom:el.availFrom,availTo:el.availTo,practiceTsk:el.practiceTsk}})),tempEnArr=appVoca.practiceArr.map((function(el){return el.en})),dataKeys.forEach((function(elem){tempEnArr.forEach((function(el,i){appVoca.data[elem].en===el&&(appVoca.practiceArr[i].key=elem)}))})),renderClssFilters(clsses=appVoca.practiceArr.map((function(el){return el.forClss})).reduce((function(acc,val){return acc.concat(val)}),[]).filter((function(el,idx,arr){return void 0!==el&&arr.indexOf(el)===idx}))))}function getPracticeFromDb(){var user=firebase.auth().currentUser,arr;firebase.database().ref("practice/"+user.uid).once("value").then((function(snapshot){triggerClssFilters(arr=snapshot.val()||[])}),(function(e){chkPermission(e)}))}function filterByClss(el){el.target!==el.currentTarget&&("BUTTON"===el.target.nodeName?toggleOnlineClssBtn(el.target):"INPUT"===el.target.nodeName&&"radio"===el.target.type&&triggerClssHighlighting(void 0,el.target.value)),el.stopPropagation()}function clearClssHighlightingInTasksAndFoo(){var els;Array.from(docEl("tsks1To4Divs").querySelectorAll("li.category.btn-onlineClss")).forEach((function(elem){elem.className=elem.className.replace(/(?:^|\s)btn-onlineClss(?!\S)/g,"")}))}function toggleOnlineClssBtn(el){var elsActive;el.classList.contains("active")?(el.className=el.className.replace(/(?:^|\s)active(?!\S)/g,""),clearClssHighlightingInTasksAndFoo()):((elsActive=Array.from(docEl("cls-filters").querySelectorAll("button.active"))).forEach((function(elem){elem.className=elem.className.replace(/(?:^|\s)active(?!\S)/g,"")})),el.className+=" active",triggerClssHighlighting(el.dataset.cls,void 0))}function triggerClssHighlighting(clss,tsk){var arg,dates;if(clearClssHighlightingInTasksAndFoo(),null==clss){if(!(arg=Array.from(docEl("cls-filters").querySelectorAll("button.active"))).length)return;clss=arg[0].dataset.cls}if(null==tsk){if(!(arg=Array.from(docEl("cls-filters").querySelectorAll("input[type='radio']:checked"))).length)return;tsk=arg[0].value}arg=Array.from(docEl("cls-filters").querySelectorAll("input[type='date']"));try{dates={a:Date.parse(arg[0].value),b:Date.parse(arg[1].value)}}catch(e){dates=setDatesForClssFilters()}highlightOnlinePracticeByClss(clss,tsk,dates.a,dates.b)}function highlightOnlinePracticeByClss(clss,tsk,availFrom,availTo){var liEls=Array.from(docEl("tsks1To4Divs").querySelectorAll("li.category")),uidsArr=appVoca.practiceArr.filter((function(el){return-1!==el.forClss.indexOf(clss)&&-1!==el.practiceTsk.indexOf(tsk)&&availFrom<=el.availFrom&&availTo>=el.availTo})).map((function(elem){return elem.key})).filter((function(ele,idx,arr){return arr.indexOf(ele)===idx}));liEls.forEach((function(el){-1!==uidsArr.indexOf(el.dataset.uid)&&(el.className+=" btn-onlineClss")}))}function initFailed(e){var user,updates;emptyContent(docEl("fullNav")),emptyContent(docEl("fullVocaLists")),emptyContent(docEl("fullLayout")),emptyContent(docEl("fullRequest")),emptyContent(docEl("reqAllColDistractors")),emptyContent(docEl("fullPrevious")),showEl("welcomeMsg"),"PERMISSION_DENIED"===e.code&&((user=firebase.auth().currentUser)?(buildWelcomeMsg(user.displayName),(updates={})["newUser/pe4/"+user.uid]=user.displayName,firebase.database().ref().update(updates).then(window.setTimeout(signOutOfApp,7e3))):signOutOfApp())}function buildWelcomeMsg(name){var container=docEl("welcomeMsg"),frag=document.createDocumentFragment(),newDiv0=document.createElement("DIV"),newDiv1=document.createElement("DIV"),newH2=document.createElement("H2"),newP=document.createElement("P"),nme=capitalizeUserName(name);newDiv0.className="row contentBox",newDiv0.style.marginTop="80px",newDiv1.className="col-lg-12 text-left",newH2.textContent="Access denied",newP.textContent="Hello "+nme+"! If you are known to us, access will soon be granted.",newDiv1.appendChild(newH2),newDiv1.appendChild(newP),newDiv0.appendChild(newDiv1),frag.appendChild(newDiv0),container.appendChild(frag)}function initApp(){getVocaFromDb()}function startApp(){populateFoo("foo",appVoca.data),populateFoo("foo2",appVoca.texts),makeSortables(),calculateSettings(),docEl("currentDate").textContent=appVoca.settings.date,handlersOn(),showEl("fullVocaLists"),showEl("screenButtons"),showEl("examType"),showEl("spanB4examVersion"),showEl("examVersion"),showEl("currentDate"),getPracticeFromDb()}firebase.auth().onAuthStateChanged((function(user){user?(docEl("usrPhoto").src=user.photoURL,appVoca.settings.user=capitalizeUserName(user.displayName),initApp()):window.location="../index.html"}))}()}));