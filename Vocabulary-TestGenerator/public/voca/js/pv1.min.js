window.addEventListener("load",function(){!function(){"use strict";var p={practiceArr:[],settings:{user:"",bookUnits:[],defaultNow:"",defaultFuture:""},data:{},texts:{}};function n(){firebase.auth().signOut()}function y(e){return document.getElementById(e)}function N(e){for(;e.hasChildNodes();){for(;e.lastChild.hasChildNodes();)e.lastChild.removeChild(e.lastChild.lastChild);e.removeChild(e.lastChild)}}function r(e){y(e).classList.contains("nodisplay")||(y(e).className+=" nodisplay")}function c(e){y(e).className=y(e).className.replace(/(?:^|\s)nodisplay(?!\S)/g,"")}function o(){r("errorFbk"),r("errorFbkCancel"),y("errorFbk").value="",y("reportError").textContent="Report error"}function a(){var e,t={},a=Array.from(y("classBuckets").querySelectorAll("li.previewSelected"));if(a.length){if(e=a[0],t.task=e.parentElement.dataset.task||"unknown",y("errorFbk").classList.contains("nodisplay"))return y("reportError").textContent="Confirm error",void c("errorFbk");!function(e,t){var a=y("errorFbk").value;if(""===a)return window.mscAlert({title:"",subtitle:"Please describe the issue briefly."});e.descr=a,e.uid=t.dataset.uid,e.user=p.settings.user,void 0!==e.uid?function(t,e,a,n){var r=firebase.database().ref().child(e).push().key,c={};c[e+r]=t,firebase.database().ref().update(c,function(e){e?b(e):(null!==a&&(a[r]=t),window.mscAlert({title:"",subtitle:n}))})}(e,"data/pe4/errors/",null,"Thank you! The error was reported."):window.mscAlert({title:"",subtitle:"Cannot identify the record. The error cannot be reported."});o()}(t,e)}}function l(e){e.target!==e.currentTarget&&("SPAN"===e.target.nodeName?""!==e.target.id?function(e){var t=e.split("_");switch(t[0]){case"del":!function(e){var t,a=y("bkt_"+e);null!==a&&(void 0!==(t=Array.from(a.querySelectorAll("input[type='text']"))[0])&&(t.value="",t.dataset.removed="true"),w(y("syn_"+e)),w(y("gmr_"+e)),w(y("col_"+e)),r("bkt_"+e))}(t[1]);break;case"clp":!function(e){var t,a=y("bkt_"+e),n=Array.from(a.children);null!==a&&((t=y("clp_"+e)).classList.contains("collapsed")?t.className=t.className.replace(/(?:^|\s)collapsed(?!\S)/g,""):t.className+=" collapsed",n.forEach(function(e){e.classList.contains("pink2bg")||(e.classList.contains("nodisplay")?e.className=e.className.replace(/(?:^|\s)nodisplay(?!\S)/g,""):e.className+=" nodisplay")}))}(t[1]);break;default:;}}(e.target.id):e.target.classList.contains("pvR-btn")?function(e){var t=e.parentElement.parentElement;t.classList.contains("category")&&(t.parentNode.removeChild(t),N(y("previewExamExmpl")),N(y("previewPracticeExmpl")),o())}(e.target):t(e.target.parentElement):function(e){"LI"===e.nodeName&&void 0!==e.dataset.uid&&t(e)}(e.target),e.stopPropagation())}function i(e,t,a,n){var r=p.data[e].en,c=p.data[e][n][t],o={b4:"",en:"",af:"",opts:{a:"",b:"",c:"",d:""}},l=!1,i=!1;"col"===t?(l=!0,o.en=r,o[c.pos]="_____",o.opts.a="a. "+c.dis1+" | "+c.dis2+" | "+c.ans1,o.opts.b="b. "+c.ans2+" | "+c.ans3+" | "+c.dis3,o.opts.c="c. "+c.dis3+" | "+c.dis1+" | "+c.dis2,o.opts.d="d. "+c.ans1+" | "+c.ans2+" | "+c.ans3):(o.b4=c.b4,o.af=c.af,o.opts.b="b. "+c.dis1,o.opts.c="c. "+c.dis2,o.opts.d="d. "+c.ans,!1===a?(o.en="_____","syn"===t?i=!0:"practice"===n?(o.opts.a="a. "+c.dis3,o.opts.d="d. "+r):o.opts.a="a. "+r):(o.en=r,o.opts.a="a. "+c.dis3)),function(e,t,a,n,r){var c,o,l,i,s,d,u=document.createDocumentFragment(),p=document.createElement("DIV"),m=document.createElement("DIV"),f=document.createElement("SPAN"),h=document.createElement("SPAN"),g=document.createElement("SPAN"),v=document.createElement("SPAN");"exam"===r?c=y("previewExamExmpl"):(c=y("previewPracticeExmpl"),(d=document.createElement("LABEL")).className="label label-xs label-color777",d.textContent="Practice",p.appendChild(d));N(c),!0===a&&(m.style.display="none");p.className="previewExmplDiv","practice"===r&&p.appendChild(d);!0===n?(l=document.createElement("SPAN"),i=document.createTextNode(e.b4+" "),s=document.createTextNode(" "+e.af),l.textContent=e.en,l.style.textDecoration="underline",p.appendChild(i),p.appendChild(l),p.appendChild(s)):(i=document.createTextNode(e.b4+" "+e.en+" "+e.af),p.appendChild(i));f.className="previewExmplSpan",h.className="previewExmplSpan",g.className="previewExmplSpan",v.className="previewExmplSpan encircled",f.textContent=e.opts.a,h.textContent=e.opts.b,g.textContent=e.opts.c,v.textContent=e.opts.d,m.appendChild(f),m.appendChild(h),!0===t&&(o=document.createElement("BR"),m.appendChild(o));m.appendChild(g),m.appendChild(v),u.appendChild(p),u.appendChild(m),c.appendChild(u)}(o,l,i,a,n)}function k(e){e.item.classList.contains("previewSelected")&&(e.item.className=e.item.className.replace(/(?:^|\s)previewSelected(?!\S)/g,""),N(y("previewExamExmpl")),N(y("previewPracticeExmpl")),o()),e.stopPropagation()}function s(){Array.from(y("classBuckets").querySelectorAll("li.category.previewSelected")).forEach(function(e){e.className=e.className.replace(/(?:^|\s)previewSelected(?!\S)/g,"")}),N(y("previewExamExmpl")),N(y("previewPracticeExmpl")),o()}function t(e){var t=e.dataset.uid,a=e.parentElement.dataset.task,n="syn"===a,r=e.classList.contains("previewSelected");void 0!==t&&p.data[t].exam.hasOwnProperty(a)&&(r?(s(),e.className=e.className.replace(/(?:^|\s)previewSelected(?!\S)/g,"")):(s(),e.className+=" previewSelected",i(t,a,n,"exam"),i(t,a,n,"practice")))}function d(e,t,a,n){var r,c=y(e),o=document.createDocumentFragment(),l=document.createElement("LI"),i=document.createTextNode(a);l.className="category",l.dataset.uid=t,l.appendChild(i),"0"!==n?((r=document.createElement("SPAN")).className="encircled",r.textContent=n,l.className+=" purplerain",l.appendChild(r)):"foo2"!==e&&"bop"!==e||((r=document.createElement("SPAN")).textContent=p.texts[t].tgts.join(", "),r.className+=" t5tgtsList",l.appendChild(r)),o.appendChild(l),c.appendChild(o)}function u(){var t=Array.from(y("foo3").querySelectorAll("li.category")),e=Array.from(y("foo3-filters").querySelectorAll('input[type="checkbox"]')).filter(function(e){return void 0!==e.dataset.book&&!0===e.checked}).map(function(e){return e.dataset.book});t.forEach(function(e){e.classList.contains("filteredOut")||(e.className+=" filteredOut")}),e.forEach(function(e){(function(e,t){return"0"===t?e.filter(function(e){return!e.classList.contains("purplerain")}):e.filter(function(e){return e.classList.contains("purplerain")&&p.data[e.dataset.uid].book===t})})(t,e).forEach(function(e){e.classList.contains("filteredOut")&&(e.className=e.className.replace(/(?:^|\s)filteredOut(?!\S)/g,""))})})}function m(e){e.target!==e.currentTarget&&("LI"===e.target.nodeName&&void 0!==e.target.dataset.uid?f(e.target):"SPAN"===e.target.nodeName&&void 0!==e.target.parentElement.dataset.uid&&f(e.target.parentElement),e.stopPropagation())}function f(e){var t=p.texts[e.dataset.uid].tgts||[];Array.from(y("fullClassLists").querySelectorAll("li.category.purpleborder")).forEach(function(e){e.className=e.className.replace(/(?:^|\s)purpleborder(?!\S)/g,"")}),function(t){var e=Array.from(y("foo3").querySelectorAll("li.category")),a=Array.from(y("classBuckets").querySelectorAll("li.category"));e.forEach(function(e){-1!==t.indexOf(p.data[e.dataset.uid].en)&&(e.className+=" purpleborder")}),a.forEach(function(e){-1!==t.indexOf(p.data[e.dataset.uid].en)&&(e.className+=" purpleborder")})}(t),e.classList.contains("purpleborder")||(e.className+=" purpleborder")}function h(e){e.target!==e.currentTarget&&("A"===e.target.nodeName&&void 0!==e.target.dataset.func&&function(e){switch(e){case"olp":!function(){if(-1!==Array.from(y("classBuckets").querySelectorAll("input[type='text']")).filter(function(e){return null==e.dataset.removed}).map(function(e){return e.value}).indexOf(""))return window.mscConfirm({title:"",subtitle:"Classes that are left unnamed will be discarded. Proceed?",cancelText:"Cancel",onOk:function(){v()},onCancel:function(){}});v()}();break;case"oxt":window.location="index.html";break;default:;}}(e.target.dataset.func),e.stopPropagation())}function g(e){return e.map(function(e){return JSON.stringify(e)}).filter(function(e,t,a){return a.indexOf(e)===t}).map(function(e){return JSON.parse(e)})}function v(){var t,e,a,n=function(){var t,a,n,r,c,e=Array.from(y("classBuckets").children),o=["syn","gmr","col"],l=[];return e.forEach(function(e){void 0!==e.id&&""!==e.id&&(t=e.id.split("_")[1],r=[],void 0!==(a=Array.from(e.querySelectorAll("input[type='text']"))[0])&&(n=a.value||""),""!==n&&(o.forEach(function(e){void 0!==(c=function(t,e,a){var n,r,c,o,l=y(t+"_"+e);null!==l&&(c=Array.from(l.querySelectorAll("li.category"))).length&&(n=[],c.forEach(function(e){if(r=[e.dataset.uid],void 0!==(o=Array.from(e.querySelectorAll("input[type='date']")))[0]&&void 0!==o[1])try{r[1]=Date.parse(o[0].value)||p.settings.defaultNow,r[2]=Date.parse(o[1].value)||p.settings.defaultFuture}catch(e){r[1]=p.settings.defaultNow,r[2]=p.settings.defaultFuture}else r[1]=p.settings.defaultNow,r[2]=p.settings.defaultFuture;r[3]=t,r[4]=a,13===r[1].toString().length&&13===r[2].toString().length&&n.push(r)}));return n}(e,t,n))&&c.length&&c.forEach(function(e){r.push(e)})}),l.push(r)))}),l=l.reduce(function(e,t){return e.concat(t)},[])}()||[],r=[],c=n.map(function(e){return e[4]}).filter(function(e,t,a){return a.indexOf(e)===t});(e=g(e=n.map(function(e){return[e[0],e[1],e[2],[],[e[4]]]}))).forEach(function(t){n.forEach(function(e){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4][0]&&-1===t[3].indexOf(e[3])&&(t[3].push(e[3]),1<t[3].length&&t[3].sort(function(e,t){return e.localeCompare(t)}))})}),(n=g(e.slice(0))).forEach(function(t){e.forEach(function(e){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&(!function(e,t){var a;if(e.length!==t.length)return!1;for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}(e[3],t[3])||-1!==t[4].indexOf(e[4][0])||(t[4].push(e[4][0]),1<t[4].length&&t[4].sort(function(e,t){return e.localeCompare(t)})))})}),(e=g(n.slice(0))).forEach(function(e){for(t={availFrom:e[1],availTo:e[2],practiceTsk:e[3],forClss:e[4],en:p.data[e[0]].en,kr:p.data[e[0]].practice.kr,ctxEn:p.data[e[0]].practice.enCtx||"",ctxKr:p.data[e[0]].practice.ctxKr},a=e[3].length-1;0<=a;a--)-1!==p.data[e[0]].allowTsk.indexOf(e[3][a])?t[e[3][a]]=p.data[e[0]].practice[e[3][a]]:e[3].splice(a,1);e[3].length&&r.push(t)}),function(t,e){var a=firebase.auth().currentUser,n={},r=function(e){var t,a,n=e.length,r=Math.ceil(n/6),c=new Array(6);for(a=t=0;t<6;++t,a+=r)c[t]=e.substr(a,r);return c}(JSON.stringify(t));n["practice/"+a.uid]=t,n["practice/tchrIndex/"+a.uid]={name:a.displayName,clsses:e},n["practice/gsheets/"+a.uid]={displayName:a.displayName,clsses:JSON.stringify(e),pta:r[0]||"",ptb:r[1]||"",ptc:r[2]||"",ptd:r[3]||"",pte:r[4]||"",ptf:r[5]||"",timeStamp:Date.now().toString()},firebase.database().ref().update(n,function(e){e?b(e):(p.practiceArr=t,window.mscAlert({title:"",subtitle:"Your online vocabulary has been updated!"}))})}(r,c)}function b(e){var t,a;"PERMISSION_DENIED"===e.code&&((t=firebase.auth().currentUser)?((a={})["newUser/pe4/"+t.uid]=t.displayName,firebase.database().ref().update(a).then(n())):n())}function C(){E("",!1)}function E(e,t){var a=y("classBuckets"),n=document.createDocumentFragment(),r=document.createElement("DIV"),c=document.createElement("DIV"),o=document.createElement("DIV"),l=document.createElement("DIV"),i=document.createElement("DIV"),s=document.createElement("DIV"),d=document.createElement("DIV"),u=document.createElement("DIV"),p=document.createElement("DIV"),m=document.createElement("DIV"),f=document.createElement("DIV"),h=document.createElement("DIV"),g=document.createElement("SPAN"),v=document.createElement("SPAN"),N=document.createElement("INPUT"),b=document.createElement("UL"),C=document.createElement("UL"),E=document.createElement("UL"),x=Array.from(y("classBuckets").children).length-1+1;if(r.id="bkt_"+x,r.className="col-lg-12",r.style.marginBottom="40px",c.className="row pink2bg",o.className="col-lg-12",l.style.padding="2px 0",N.type="text",N.value=e,N.placeholder="class name",g.id="clp_"+x,g.className="caret",v.id="del_"+x,v.className="btn btn-xs btn-default pvR1-btn pull-right",v.textContent="X",i.className="row text-center",s.className="col-lg-4 col-md-4 col-sm-4 col-xs-4",s.textContent="Synonyms",d.className="col-lg-4 col-md-4 col-sm-4 col-xs-4",d.textContent="Grammar",u.className="col-lg-4 col-md-4 col-sm-4 col-xs-4",u.textContent="Collocations",p.className="row",m.className="col-lg-4 col-md-4 col-sm-4 col-xs-4 pinkbg",f.className="col-lg-4 col-md-4 col-sm-4 col-xs-4 pinkbg",h.className="col-lg-4 col-md-4 col-sm-4 col-xs-4 pinkbg",b.id="syn_"+x,b.dataset.task="syn",C.id="gmr_"+x,C.dataset.task="gmr",E.id="col_"+x,E.dataset.task="col",l.appendChild(g),l.appendChild(N),l.appendChild(v),o.appendChild(l),c.appendChild(o),i.appendChild(s),i.appendChild(d),i.appendChild(u),m.appendChild(b),f.appendChild(C),h.appendChild(E),p.appendChild(m),p.appendChild(f),p.appendChild(h),r.appendChild(c),r.appendChild(i),r.appendChild(p),n.appendChild(r),a.appendChild(n),Sortable.create(y("syn_"+x),{group:"qux",animation:0,multiDrag:!0,onEnd:function(e){k(e)},onAdd:function(e){A(e)}}),Sortable.create(y("gmr_"+x),{group:"qux",animation:0,multiDrag:!0,onEnd:function(e){k(e)},onAdd:function(e){A(e)}}),Sortable.create(y("col_"+x),{group:"qux",animation:0,multiDrag:!0,onEnd:function(e){k(e)},onAdd:function(e){A(e)}}),!0===t)return x}function x(e,t,a){var n,r,c,o=y(t+"_"+a);if(null!==o&&void 0!==(n=function(t){return Object.keys(p.data).filter(function(e){return p.data[e].en===t})[0]}(e.en))&&-1!==p.data[n].allowTsk.indexOf(t)){try{r=new Date(e.availFrom).toISOString().substring(0,10)||p.settings.defaultNow,c=new Date(e.availTo).toISOString().substring(0,10)||p.settings.defaultFuture}catch(e){S(o,n,p.settings.defaultNow,p.settings.defaultFuture)}S(o,n,r,c)}}function S(e,t,a,n){if(null!==e){var r,c=document.createDocumentFragment(),o=document.createElement("LI"),l=document.createElement("DIV"),i=document.createElement("INPUT"),s=document.createElement("INPUT"),d=document.createElement("SPAN"),u=document.createTextNode(p.data[t].en);o.className="category",o.dataset.uid=t,l.className="pull-right",i.type="date",i.value=a,s.type="date",s.value=n,d.className="btn btn-xs btn-default pvR-btn",d.textContent="X",l.appendChild(i),l.appendChild(s),l.appendChild(d),o.appendChild(u),"0"!==p.data[t].book&&((r=document.createElement("SPAN")).className="encircled",r.textContent=p.data[t].book,o.className+=" purplerain",o.appendChild(r)),o.appendChild(l),c.appendChild(o),e.appendChild(c)}}function w(e){null!==e&&(N(e),function(e){Sortable.get(e).option("disabled",!0)}(e))}function A(t){t.items.length?t.items.forEach(function(e){L(t,e)}):L(t,t.item)}function L(e,t){if(s(),!0===function(e,t){var a=y(e.to.id),n=Array.from(a.querySelectorAll("li.category")).filter(function(e){return e.dataset.uid===t.dataset.uid}),r=!0;1<n.length&&(r=!1);-1===p.data[t.dataset.uid].allowTsk.indexOf(e.to.dataset.task)&&(r=!1);return r}(e,t)){var a=t.cloneNode(!0);return"foo3"===e.from.id?(function(e,t,a){var n=document.createDocumentFragment(),r=document.createElement("DIV"),c=document.createElement("INPUT"),o=document.createElement("INPUT"),l=document.createElement("SPAN");r.className="pull-right",c.type="date",c.value=t,o.type="date",o.value=a,l.className="btn btn-xs btn-default pvR-btn",l.textContent="X",r.appendChild(c),r.appendChild(o),r.appendChild(l),n.appendChild(r),e.appendChild(n)}(t,p.settings.defaultNow,p.settings.defaultFuture),a.className=a.className.replace(/(?:^|\s)sortable-selected(?!\S)/g,""),void e.from.insertBefore(a,e.from.firstChild)):(a.className=a.className.replace(/(?:^|\s)sortable-selected(?!\S)/g,""),void e.from.appendChild(a))}D(t,e.from)}function D(e,t){var a=e.cloneNode(!0);e.parentElement.removeChild(e),t.appendChild(a),a.className=a.className.replace(/(?:^|\s)sortable-selected(?!\S)/g,""),a.classList.contains("previewSelected")&&(a.className=a.className.replace(/(?:^|\s)previewSelected(?!\S)/g,""))}firebase.auth().onAuthStateChanged(function(e){e?(y("usrPhoto").src=e.photoURL,p.settings.user=function(e){return e.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}(e.displayName),function(){var t;firebase.database().ref("data/pe4/exams").once("value").then(function(e){null!==(t=e.val())&&(p.data=t.ledata||{},p.texts=t.letexts||{},c("screenButtons"),function(){var e=firebase.auth().currentUser;firebase.database().ref("practice/"+e.uid).once("value").then(function(e){p.practiceArr=e.val()||[],function(t,a){var e=Object.keys(a);if("foo2"===t)return e.sort(function(e,t){return a[e].ctx.localeCompare(a[t].ctx)}),e.forEach(function(e){d(t,e,a[e].ctx.toLocaleUpperCase(),"0")});e.sort(function(e,t){return a[e].en.localeCompare(a[t].en)}),e.forEach(function(e){a[e].hasOwnProperty("allowTsk")&&d(t,e,a[e].en,a[e].book)})}("foo3",p.data),function(){var a=p.texts,e=Object.keys(a);e.sort(function(e,t){return a[e].ctx.localeCompare(a[t].ctx)}),e.forEach(function(e){d("foo4",e,a[e].ctx.toLocaleUpperCase(),"0")})}(),function(){var e,a;p.practiceArr.map(function(e){return e.forClss}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e,t,a){return a.indexOf(e)===t}).forEach(function(t){e=p.practiceArr.filter(function(e){return-1!==e.forClss.indexOf(t)}),a=E(t,!0),e.forEach(function(e){-1!==e.practiceTsk.indexOf("syn")&&x(e,"syn",a),-1!==e.practiceTsk.indexOf("gmr")&&x(e,"gmr",a),-1!==e.practiceTsk.indexOf("col")&&x(e,"col",a)})})}(),function(){var e=Object.keys(p.data);p.settings.bookUnits=e.map(function(e){return p.data[e].book}).filter(function(e,t,a){return a.indexOf(e)===t&&void 0!==e&&""!==e&&"0"!==e}),p.settings.bookUnits.sort(function(e,t){return e-t}),function(){var a,n,e=y("foo3-filters"),r=document.createDocumentFragment(),t=document.createElement("INPUT"),c=document.createElement("Label");N(e),t.type="checkbox",t.id="fltrX",t.checked="true",t.dataset.book="0",c.htmlFor="fltrX",c.textContent="Not in book",r.appendChild(t),r.appendChild(c),p.settings.bookUnits.forEach(function(e,t){a=document.createElement("INPUT"),n=document.createElement("Label"),a.type="checkbox",a.id="fltr"+t,a.checked="true",a.dataset.book=e,n.htmlFor="fltr"+t,n.textContent="Unit "+e,r.appendChild(a),r.appendChild(n)}),e.appendChild(r)}()}(),function(){var e=Date.now(),t=e+13148719167;p.settings.defaultNow=new Date(e).toISOString().substring(0,10),p.settings.defaultFuture=new Date(t).toISOString().substring(0,10)}(),Sortable.create(y("foo3"),{group:"qux",animation:0,sort:!1,multiDrag:!1,onAdd:function(e){D(e.item,e.from)}}),y("foo3-filters").addEventListener("click",u,{capture:!1,passive:!0}),y("foo4").addEventListener("click",m,{capture:!1,passive:!0}),y("screenButtons").addEventListener("click",h,{capture:!1,passive:!0}),y("addNewClssBtn").addEventListener("click",C,{capture:!1,passive:!0}),y("classBuckets").addEventListener("click",l,{capture:!1,passive:!0}),y("logout").addEventListener("click",n,{capture:!1,passive:!0}),y("reportError").addEventListener("click",a,{capture:!1,passive:!0}),c("addNewClssBtn")},function(e){b(e)})}())},function(e){b(e)})}()):window.location="../index.html"})}()});